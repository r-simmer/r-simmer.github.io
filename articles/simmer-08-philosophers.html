<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dining Philosophers Problem • simmer | DES for R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Dining Philosophers Problem">
<meta property="og:description" content="simmer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115358925-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115358925-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simmer | DES for R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href=".././">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-gears"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simmer-01-introduction.html">Introduction to simmer</a>
    </li>
    <li>
      <a href="../articles/simmer-02-jss.pdf">JSS paper (PDF)</a>
    </li>
    <li>
      <a href="../articles/simmer-03-trajectories.html">Advanced Trajectory Usage</a>
    </li>
    <li>
      <a href="../articles/simmer-04-bank-1.html">The Bank Tutorial: Part I</a>
    </li>
    <li>
      <a href="../articles/simmer-04-bank-2.html">The Bank Tutorial: Part II</a>
    </li>
    <li>
      <a href="../articles/simmer-05-simpy.html">Other SimPy Examples</a>
    </li>
    <li>
      <a href="../articles/simmer-06-queueing.html">Queueing Systems</a>
    </li>
    <li>
      <a href="../articles/simmer-07-ctmc.html">Continuous-Time Markov Chains</a>
    </li>
    <li>
      <a href="../articles/simmer-08-philosophers.html">Dining Philosophers Problem</a>
    </li>
    <li>
      <a href="../articles/simmer-aa-5G.html">Design and Analysis of 5G Scenarios</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/r-simmer/simmer">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Extensions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../extensions/plot">simmer.plot</a>
    </li>
    <li>
      <a href="../extensions/bricks">simmer.bricks</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.optim">simmer.optim</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.json">simmer.json</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.mon">simmer.mon</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Dining Philosophers Problem</h1>
                        <h4 class="author">Iñaki Ucar</h4>
            
            <h4 class="date">2020-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-simmer/simmer/blob/master/vignettes/simmer-08-philosophers.Rmd"><code>vignettes/simmer-08-philosophers.Rmd</code></a></small>
      <div class="hidden name"><code>simmer-08-philosophers.Rmd</code></div>

    </div>

    
    
<div id="problem-description" class="section level2">
<h2 class="hasAnchor">
<a href="#problem-description" class="anchor"></a>Problem description</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Dining_philosophers_problem">Dining Philosophers problem</a> is a classical example in computer science to illustrate synchronisation issues in concurrent processes. It was originally formulated in 1965 by <a href="https://en.wikipedia.org/wiki/Edsger_W._Dijkstra">E. W. Dijkstra</a> as a student exam exercise, and was later reworked in its current form by <a href="https://en.wikipedia.org/wiki/Tony_Hoare">Tony Hoare</a>:</p>
<blockquote>
<p><span class="math inline">\(N\)</span> silent philosophers sit at a round table with bowls of spaghetti. Forks are placed between each pair of adjacent philosophers.</p>
<p>Each philosopher must alternately think and eat. However, a philosopher can only eat spaghetti when they have both left and right forks. Each fork can be held by only one philosopher and so a philosopher can use the fork only if it is not being used by another philosopher. After an individual philosopher finishes eating, they need to put down both forks so that the forks become available to others. A philosopher can take the fork on their right or the one on their left as they become available, but cannot start eating before getting both forks.</p>
</blockquote>
<div style="text-align:center">
<div class="figure">
<img src="includes/philosophers.png" alt="Dining Philosophers, with N=4."><p class="caption">Dining Philosophers, with <span class="math inline">\(N=4\)</span>.</p>
</div>
</div>
<blockquote>
<p>The problem is how to design a discipline of behavior (a concurrent algorithm) such that no philosopher will starve; i.e., each can forever continue to alternate between eating and thinking, assuming that no philosopher can know when others may want to eat or think.</p>
</blockquote>
</div>
<div id="simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h2>
<p>Let us define each philosopher as a process executing a thinking + eating loop, and acting concurrently on shared resources (the forks). Each process will follow a similar trajectory in which they</p>
<ol style="list-style-type: decimal">
<li>Spend some random time thinking until they become hungry.</li>
<li>Take one fork, when available, following a given policy.</li>
<li>After some lag, take the other fork, when available.</li>
<li>Spend some random time eating.</li>
<li>Put both forks down and go back to 1.</li>
</ol>
<p>The following function sets up a simulation of <span class="math inline">\(N\)</span> dining philosophers as established above:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">simmer</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">simmer.plot</span>)

<span class="no">simulate</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">fork_seq</span>, <span class="no">time</span>, <span class="no">thinking</span><span class="kw">=</span><span class="kw">function</span>() <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span>(<span class="fl">1</span>, <span class="fl">1</span>),
                     <span class="no">eating</span><span class="kw">=</span><span class="kw">function</span>() <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span>(<span class="fl">1</span>, <span class="fl">1</span>), <span class="no">lag</span><span class="kw">=</span><span class="fl">0.1</span>, <span class="no">seed</span><span class="kw">=</span><span class="fl">333</span>)
{
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="no">seed</span>)

  <span class="no">env</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span>(<span class="st">"Dining philosophers"</span>)

  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">fork_seq</span>)) {
    <span class="no">philosopher</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">fork_seq</span>)<span class="kw">[[</span><span class="no">i</span>]]
    <span class="no">forks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"fork_"</span>, <span class="no">fork_seq</span><span class="kw">[[</span><span class="no">i</span>]])

    <span class="no">dining</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/timeout.html">timeout</a></span>(<span class="no">thinking</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/seize.html">seize</a></span>(<span class="no">forks</span><span class="kw">[[</span><span class="fl">1</span>]]) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/timeout.html">timeout</a></span>(<span class="no">lag</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/seize.html">seize</a></span>(<span class="no">forks</span><span class="kw">[[</span><span class="fl">2</span>]]) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/timeout.html">timeout</a></span>(<span class="no">eating</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/seize.html">release</a></span>(<span class="no">forks</span><span class="kw">[[</span><span class="fl">1</span>]]) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/seize.html">release</a></span>(<span class="no">forks</span><span class="kw">[[</span><span class="fl">2</span>]]) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/rollback.html">rollback</a></span>(<span class="fl">7</span>) <span class="co"># back to think</span>

    <span class="no">env</span> <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"fork_"</span>, <span class="no">i</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">philosopher</span>, <span class="st">"_"</span>), <span class="no">dining</span>, <span class="fu"><a href="../reference/generators.html">at</a></span>(<span class="fl">0</span>))
  }

  <span class="fu"><a href="../reference/run.html">run</a></span>(<span class="no">env</span>, <span class="no">time</span>)
}</pre></body></html></div>
<p>The <code>fork_seq</code> argument consists of a named list of fork sequences. For instance, given the numbering conventions in the image above, if we decide that philosopher 1, Socrates, must take fork 1 first and then fork 2, his fork sequence would be <code>Socrates = c(1, 2)</code>. This function also expects the simulation <code>time</code>, and there are other arguments to play with, such as the <code>thinking</code> and <code>eating</code> random processes, the <code>lag</code> between forks, and the seed.</p>
<p>The following function would allow us to plot a kind of Gantt chart of the simulation:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">states</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hungry"</span>, <span class="st">"eating"</span>)

<span class="no">philosophers_gantt</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">env</span>, <span class="no">size</span><span class="kw">=</span><span class="fl">15</span>) <span class="no">env</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(<span class="kw">per_resource</span><span class="kw">=</span><span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span>(<span class="kw">philosopher</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span>(<span class="st">"_[0-9]*"</span>, <span class="st">""</span>, <span class="no">name</span>),
            <span class="kw">state</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">states</span>, <span class="no">states</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">y</span><span class="kw">=</span><span class="no">philosopher</span>, <span class="kw">yend</span><span class="kw">=</span><span class="no">philosopher</span>)) + <span class="fu">xlab</span>(<span class="st">"time"</span>) +
  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">start_time</span>, <span class="kw">xend</span><span class="kw">=</span><span class="no">end_time</span>, <span class="kw">color</span><span class="kw">=</span><span class="no">state</span>), <span class="kw">size</span><span class="kw">=</span><span class="no">size</span>)</pre></body></html></div>
<p>With the simplest algorithm, each philosopher would take, for example, the right fork first and then the left one. But it is easy to see that this policy may result in starvation:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">fork_seq</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">Socrates</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>),
  <span class="kw">Pythagoras</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">3</span>),
  <span class="kw">Plato</span>      <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">4</span>),
  <span class="kw">Aristotle</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>, <span class="fl">1</span>)
)

<span class="fu"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(<span class="no">fork_seq</span>, <span class="kw">time</span><span class="kw">=</span><span class="fl">50</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">philosophers_gantt</span>() + <span class="fu">theme_bw</span>()
<span class="co">#&gt; simmer environment: Dining philosophers | now: 3.89681179066325 | next: </span>
<span class="co">#&gt; { Monitor: in memory }</span>
<span class="co">#&gt; { Resource: fork_1 | monitored: TRUE | server status: 1(1) | queue status: 1(Inf) }</span>
<span class="co">#&gt; { Resource: fork_2 | monitored: TRUE | server status: 1(1) | queue status: 1(Inf) }</span>
<span class="co">#&gt; { Resource: fork_3 | monitored: TRUE | server status: 1(1) | queue status: 1(Inf) }</span>
<span class="co">#&gt; { Resource: fork_4 | monitored: TRUE | server status: 1(1) | queue status: 1(Inf) }</span>
<span class="co">#&gt; { Source: Socrates_ | monitored: 1 | n_generated: 1 }</span>
<span class="co">#&gt; { Source: Pythagoras_ | monitored: 1 | n_generated: 1 }</span>
<span class="co">#&gt; { Source: Plato_ | monitored: 1 | n_generated: 1 }</span>
<span class="co">#&gt; { Source: Aristotle_ | monitored: 1 | n_generated: 1 }</span></pre></body></html></div>
<p><img src="simmer-08-philosophers_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
<p>As we can see, the simulation stopped very soon at a point in which every philosopher holds one fork and waits for the other to be available. The solution originally proposed by Dijkstra establishes the convention that all resources must be requested in order. This means that, in our simulation, Aristotle should pick fork 1 first instead:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">fork_seq</span>$<span class="no">Aristotle</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">fork_seq</span>$<span class="no">Aristotle</span>)

<span class="fu"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(<span class="no">fork_seq</span>, <span class="kw">time</span><span class="kw">=</span><span class="fl">50</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">philosophers_gantt</span>() + <span class="fu">theme_bw</span>()
<span class="co">#&gt; simmer environment: Dining philosophers | now: 50 | next: 50.8360142024587</span>
<span class="co">#&gt; { Monitor: in memory }</span>
<span class="co">#&gt; { Resource: fork_1 | monitored: TRUE | server status: 1(1) | queue status: 0(Inf) }</span>
<span class="co">#&gt; { Resource: fork_2 | monitored: TRUE | server status: 1(1) | queue status: 1(Inf) }</span>
<span class="co">#&gt; { Resource: fork_3 | monitored: TRUE | server status: 1(1) | queue status: 0(Inf) }</span>
<span class="co">#&gt; { Resource: fork_4 | monitored: TRUE | server status: 1(1) | queue status: 0(Inf) }</span>
<span class="co">#&gt; { Source: Socrates_ | monitored: 1 | n_generated: 1 }</span>
<span class="co">#&gt; { Source: Pythagoras_ | monitored: 1 | n_generated: 1 }</span>
<span class="co">#&gt; { Source: Plato_ | monitored: 1 | n_generated: 1 }</span>
<span class="co">#&gt; { Source: Aristotle_ | monitored: 1 | n_generated: 1 }</span></pre></body></html></div>
<p><img src="simmer-08-philosophers_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
<p>There are multiple solutions to this starvation problem, but this is probably the most straightforward way to break the <em>circularity</em> of the initial algorithm by making one philosopher pick the left fork first.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iñaki Ucar, Bart Smeets.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
