<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Queueing Systems • simmer | DES for R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Queueing Systems">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115358925-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115358925-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simmer | DES for R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href=".././">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-gears"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simmer-01-introduction.html">Introduction to simmer</a>
    </li>
    <li>
      <a href="../articles/simmer-02-jss.pdf">JSS paper (PDF)</a>
    </li>
    <li>
      <a href="../articles/simmer-03-trajectories.html">Advanced Trajectory Usage</a>
    </li>
    <li>
      <a href="../articles/simmer-04-bank-1.html">The Bank Tutorial: Part I</a>
    </li>
    <li>
      <a href="../articles/simmer-04-bank-2.html">The Bank Tutorial: Part II</a>
    </li>
    <li>
      <a href="../articles/simmer-05-simpy.html">Other SimPy Examples</a>
    </li>
    <li>
      <a href="../articles/simmer-06-queueing.html">Queueing Systems</a>
    </li>
    <li>
      <a href="../articles/simmer-07-ctmc.html">Continuous-Time Markov Chains</a>
    </li>
    <li>
      <a href="../articles/simmer-08-philosophers.html">Dining Philosophers Problem</a>
    </li>
    <li>
      <a href="../articles/simmer-aa-5G.html">Design and Analysis of 5G Scenarios</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/r-simmer/simmer">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Extensions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../extensions/plot">simmer.plot</a>
    </li>
    <li>
      <a href="../extensions/bricks">simmer.bricks</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.optim">simmer.optim</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.json">simmer.json</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.mon">simmer.mon</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Queueing Systems</h1>
                        <h4 class="author">Iñaki Ucar</h4>
            
            <h4 class="date">2019-01-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-simmer/simmer/blob/master/vignettes/simmer-06-queueing.Rmd"><code>vignettes/simmer-06-queueing.Rmd</code></a></small>
      <div class="hidden name"><code>simmer-06-queueing.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(simmer)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(simmer.plot)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1234</span>)</a></code></pre></div>
<div id="mmck-systems" class="section level2">
<h2 class="hasAnchor">
<a href="#mmck-systems" class="anchor"></a>M/M/c/k systems</h2>
<p>In Kendall’s notation, an M/M/c/k system has exponential arrivals (<strong>M</strong>/M/c/k), a <span class="math inline">\(c\)</span> servers (M/M/<strong>c</strong>/k) with exponential service time (M/<strong>M</strong>/c/k) and an <span class="math inline">\(k-c\)</span> positions in queue (M/M/c/<strong>k</strong>). For instance, a router may have several processors to handle packets, and the in/out queues are necessarily finite.</p>
<p>This is the simulation of an M/M/2/3 system (2 server, 1 position in queue). Note that the trajectory is identical to an M/M/1 system (one server, infinite queue).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">lambda &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">mu &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">m.queue &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"server"</span>, <span class="dt">amount=</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="cf">function</span>() <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">1</span>, mu)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"server"</span>, <span class="dt">amount=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">mm23.env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"server"</span>, <span class="dt">capacity=</span><span class="dv">2</span>, <span class="dt">queue_size=</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival"</span>, m.queue, <span class="cf">function</span>() <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">1</span>, lambda)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dt">until=</span><span class="dv">2000</span>)</a></code></pre></div>
<p>There are rejections when the queue is full.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(mm23.env) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="op">!</span>finished) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(finished))</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; [1] 0.04714804</span></a></code></pre></div>
<p>By solving the balance equations for this system, we obtain the following:</p>
<p><span class="math display">\[
\begin{aligned}
p_0 &amp;= \left[ \sum_{n=0}^{c-1}\frac{r^n}{n!} + \sum_{n=c}^{k}\frac{r^n}{c!c^{n-c}} \right]^{-1}\\
N &amp;= \sum_{n=0}^{\infty}nP_n = p_0\left(\sum_{n=0}^{c-n}\frac{nr^n}{n!} + \sum_{n=c}^{k}\frac{nr^n}{c!c^{n-c}}\right)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(r=\lambda/\mu\)</span>. Finally, we can see how the simulation quickly converges to the theoretical average number of customers in the system <span class="math inline">\(N\)</span>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Theoretical value</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">rho &lt;-<span class="st"> </span>lambda<span class="op">/</span>mu</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">div &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Special">factorial</a></span>(<span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span><span class="op">^</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3-2</span>))</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">mm23.N &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>rho<span class="op">^</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>div) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(rho<span class="op">^</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>div)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co"># Evolution of the average number of customers in the system</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(mm23.env), <span class="st">"usage"</span>, <span class="st">"server"</span>, <span class="dt">items=</span><span class="st">"system"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span>mm23.N)</a></code></pre></div>
<p><img src="simmer-06-queueing_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="state-dependent-service-rates" class="section level2">
<h2 class="hasAnchor">
<a href="#state-dependent-service-rates" class="anchor"></a>State-dependent service rates</h2>
<p>In many practical queueing scenarios, the speed of the server depends on the state of the system. Here we consider a multi-server resource that is able to distribute the processing capacity evenly among the arrivals. This means that if, for example, <code>capacity=2</code> and there is a single arrival in the server, it would be served twice as fast.</p>
<p>In terms of a simulation model, a state-dependent service rate implies that the time spent in the server must be asynchronously updated each time an arrival seizes or releases the resource. In consequence, first we need to define a trajectory that updates a running service delay and restarts the new time left to release the resource. The following trajectory assumes that three attributes are available:</p>
<ul>
<li>
<code>start</code>: simulation time at which the arrival started the last <code>timeout</code> activity.</li>
<li>
<code>multiplier</code>: distribution of the processing capacity.</li>
<li>
<code>delay</code>: service delay applied to the last <code>timeout</code> activity.</li>
</ul>
<p>The new delay is the time left scaled by the last and new multipliers.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">update.delay &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"start"</span>, <span class="st">"multiplier"</span>, <span class="st">"delay"</span>), <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="co"># previous multiplier, service time left</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    multiplier &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_n_generated.html">get_attribute</a></span>(env, <span class="st">"multiplier"</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    left &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="../reference/get_n_generated.html">get_attribute</a></span>(env, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"start"</span>, <span class="st">"delay"</span>))) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="../reference/now.html">now</a></span>(env)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    <span class="co"># distribute processing capacity</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    new_multiplier &lt;-<span class="st"> </span>capacity <span class="op">/</span><span class="st"> </span><span class="kw"><a href="../reference/get_capacity.html">get_server_count</a></span>(env, <span class="st">"sd.server"</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    <span class="co"># return new values</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="../reference/now.html">now</a></span>(env), new_multiplier, left <span class="op">*</span><span class="st"> </span>multiplier <span class="op">/</span><span class="st"> </span>new_multiplier)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  }) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout_from_attribute</a></span>(<span class="st">"delay"</span>)</a></code></pre></div>
<p>The main trajectory below first seizes the server and initialises the three attributes. Then, the arrivals need to follow the <code>update.delay</code> trajectory and must be interrupted at any given time to re-run it, thus re-computing the service time left. In <code>simmer</code>, this can be done with some signaling (see <code><a href="https://www.rdocumentation.org/packages/utils/topics/help">help(trap)</a></code>): a signal is subscribed and <code>update.delay</code> is registered as a handler. The first <code>send</code> signals the arriving entity, causing all the arrivals to execute the handler. Eventually, the handler finishes and the execution path returns to unregister the handler, release the server and signal the departing entity.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">sd.queue &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"sd.server"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="co"># initialisation</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"start"</span>, <span class="st">"multiplier"</span>, <span class="st">"delay"</span>), <span class="cf">function</span>()</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="../reference/now.html">now</a></span>(env), <span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">1</span>, mu))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="co"># set the handler and trigger it</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/send.html">trap</a></span>(<span class="st">"update delay"</span>, <span class="dt">handler=</span>update.delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"update delay"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">  </span><span class="co"># returning point</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/send.html">untrap</a></span>(<span class="st">"update delay"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"sd.server"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"update delay"</span>)</a></code></pre></div>
<p>In the following, we compare an M/M/2 with this state-dependent system. Both systems are fed with the same interarrival times and, as expected, the average resource usage is significantly reduced.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">lambda &lt;-<span class="st"> </span>mu &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">capacity &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">arrivals &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">time=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">2000</span><span class="op">*</span>lambda, lambda))</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="co"># M/M/2</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"server"</span>, capacity) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/add_dataframe.html">add_dataframe</a></span>(<span class="st">"arrival"</span>, m.queue, arrivals) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="st">  </span><span class="co"># state-dependent service rate</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"sd.server"</span>, capacity) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/add_dataframe.html">add_dataframe</a></span>(<span class="st">"sd.arrival"</span>, sd.queue, arrivals)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">env <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="dt">metric=</span><span class="st">"usage"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"server"</span>, <span class="st">"sd.server"</span>))</a></code></pre></div>
<p><img src="simmer-06-queueing_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="queueing-networks" class="section level2">
<h2 class="hasAnchor">
<a href="#queueing-networks" class="anchor"></a>Queueing Networks</h2>
<p>Let us consider the following network of queues (example taken from <a href="http://www.grotto-networking.com/DiscreteEventPython.html#NetQueues">Grotto Networking</a>):</p>
<div class="figure">
<img src="includes/queueing-network.svg" alt="A network of queues."><p class="caption">A network of queues.</p>
</div>
<p>There are three exponential generators (<span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>, <span class="math inline">\(\lambda_4\)</span>) that inject messages with exponential size of mean 100 bytes. There are four M/D/1 queues with a deterministic rate equal to 220 bytes/s. There is a 25% probability that messages from <span class="math inline">\(\lambda_1\)</span> are dropped before the second queue, and a fork 35/65% for the output of the second queue to reach queues 3 and 4. We are interested, for instance, in the accumulated waiting time for messages entering queue 1 and exiting queue 3 or 4.</p>
<p>We’ll start by setting up the main constants and a couple of functions to set the message size and seize an M/D/1 queue:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">mean_pkt_size &lt;-<span class="st"> </span><span class="dv">100</span>        <span class="co"># bytes</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">lambda1 &lt;-<span class="st"> </span><span class="dv">2</span>                <span class="co"># pkts/s</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">lambda3 &lt;-<span class="st"> </span><span class="fl">0.5</span>              <span class="co"># pkts/s</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">lambda4 &lt;-<span class="st"> </span><span class="fl">0.6</span>              <span class="co"># pkts/s</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">rate &lt;-<span class="st"> </span><span class="fl">2.2</span> <span class="op">*</span><span class="st"> </span>mean_pkt_size <span class="co"># bytes/s</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co"># set an exponential message size of mean mean_pkt_size</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">set_msg_size &lt;-<span class="st"> </span><span class="cf">function</span>(.)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">  <span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(., <span class="st">"size"</span>, <span class="cf">function</span>() <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">1</span>, <span class="dv">1</span><span class="op">/</span>mean_pkt_size))</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co"># seize an M/D/1 queue by id; the timeout is function of the message size</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12">md1 &lt;-<span class="st"> </span><span class="cf">function</span>(., id)</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  <span class="kw"><a href="../reference/seize.html">seize</a></span>(., <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"md1_"</span>, id), <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="cf">function</span>() <span class="kw"><a href="../reference/get_n_generated.html">get_attribute</a></span>(env, <span class="st">"size"</span>) <span class="op">/</span><span class="st"> </span>rate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"md1_"</span>, id), <span class="dv">1</span>)</a></code></pre></div>
<p>The next step is to set up the three points of attachment for our generators:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">to_queue_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">set_msg_size</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">md1</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/leave.html">leave</a></span>(<span class="fl">0.25</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw">md1</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="cf">function</span>() (<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">1</span>) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.65</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">continue=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(F, F),</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">md1</span>(<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">md1</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">to_queue_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="st">  </span><span class="kw">set_msg_size</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="st">  </span><span class="kw">md1</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15"></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">to_queue_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="st">  </span><span class="kw">set_msg_size</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="st">  </span><span class="kw">md1</span>(<span class="dv">4</span>)</a></code></pre></div>
<p>Finally, we prepare and run the simulation environment with the resources and generators required:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>()</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) env <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"md1_"</span>, i))</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">env <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival1_"</span>, to_queue_<span class="dv">1</span>, <span class="cf">function</span>() <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">1</span>, lambda1), <span class="dt">mon=</span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival3_"</span>, to_queue_<span class="dv">3</span>, <span class="cf">function</span>() <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">1</span>, lambda3), <span class="dt">mon=</span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival4_"</span>, to_queue_<span class="dv">4</span>, <span class="cf">function</span>() <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Exponential">rexp</a></span>(<span class="dv">1</span>, lambda4), <span class="dt">mon=</span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">4000</span>)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; simmer environment: anonymous | now: 4000 | next: 4000.27679472528</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; { Monitor: in memory }</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; { Resource: md1_1 | monitored: TRUE | server status: 1(1) | queue status: 4(Inf) }</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; { Resource: md1_2 | monitored: TRUE | server status: 1(1) | queue status: 4(Inf) }</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; { Resource: md1_3 | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; { Resource: md1_4 | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; { Source: arrival1_ | monitored: 2 | n_generated: 7994 }</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; { Source: arrival3_ | monitored: 2 | n_generated: 1959 }</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; { Source: arrival4_ | monitored: 2 | n_generated: 2390 }</span></a></code></pre></div>
<p>In the analysis, we filter arrivals from generator 1 that reach queues 3 and 4, and we examine the average waiting time and the total number of messages:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env, <span class="dt">per_resource =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/subset">subset</a></span>(resource <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"md1_3"</span>, <span class="st">"md1_4"</span>), <span class="dt">select=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"name"</span>, <span class="st">"resource"</span>))</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">arr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/transform">transform</a></span>(<span class="dt">waiting_time =</span> end_time <span class="op">-</span><span class="st"> </span>(start_time <span class="op">+</span><span class="st"> </span>activity_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/transform">transform</a></span>(<span class="dt">generator =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/regmatches">regmatches</a></span>(name, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">regexpr</a></span>(<span class="st">"arrival[[:digit:]]"</span>, name))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(res)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/aggregate">aggregate</a></span>(waiting_time <span class="op">~</span><span class="st"> </span>generator <span class="op">+</span><span class="st"> </span>resource, arr, <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(x)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x))</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;   generator resource waiting_time</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; 1  arrival1    md1_3    6.2313118</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; 2  arrival3    md1_3    0.7253215</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; 3  arrival1    md1_4    5.6431528</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; 4  arrival4    md1_4    0.5001096</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="kw"><a href="../reference/get_n_generated.html">get_n_generated</a></span>(env, <span class="st">"arrival1_"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/get_n_generated.html">get_n_generated</a></span>(env, <span class="st">"arrival4_"</span>)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; [1] 10384</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/aggregate">aggregate</a></span>(waiting_time <span class="op">~</span><span class="st"> </span>generator <span class="op">+</span><span class="st"> </span>resource, arr, length)</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;   generator resource waiting_time</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; 1  arrival1    md1_3         3864</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt; 2  arrival3    md1_3         1958</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt; 3  arrival1    md1_4         2177</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; 4  arrival4    md1_4         2389</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#mmck-systems">M/M/c/k systems</a></li>
      <li><a href="#state-dependent-service-rates">State-dependent service rates</a></li>
      <li><a href="#queueing-networks">Queueing Networks</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Iñaki Ucar, Bart Smeets.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
