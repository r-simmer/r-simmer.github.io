<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Queueing Systems • simmer | DES for R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Queueing Systems">
<meta property="og:description" content="simmer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115358925-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115358925-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simmer | DES for R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href=".././">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-gears"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simmer-01-introduction.html">Introduction to simmer</a>
    </li>
    <li>
      <a href="../articles/simmer-02-jss.pdf">JSS paper (PDF)</a>
    </li>
    <li>
      <a href="../articles/simmer-03-trajectories.html">Advanced Trajectory Usage</a>
    </li>
    <li>
      <a href="../articles/simmer-04-bank-1.html">The Bank Tutorial: Part I</a>
    </li>
    <li>
      <a href="../articles/simmer-04-bank-2.html">The Bank Tutorial: Part II</a>
    </li>
    <li>
      <a href="../articles/simmer-05-simpy.html">Other SimPy Examples</a>
    </li>
    <li>
      <a href="../articles/simmer-06-queueing.html">Queueing Systems</a>
    </li>
    <li>
      <a href="../articles/simmer-07-ctmc.html">Continuous-Time Markov Chains</a>
    </li>
    <li>
      <a href="../articles/simmer-08-philosophers.html">Dining Philosophers Problem</a>
    </li>
    <li>
      <a href="../articles/simmer-aa-5G.html">Design and Analysis of 5G Scenarios</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/r-simmer/simmer">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Extensions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../extensions/plot">simmer.plot</a>
    </li>
    <li>
      <a href="../extensions/bricks">simmer.bricks</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.optim">simmer.optim</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.json">simmer.json</a>
    </li>
    <li>
      <a href="https://github.com/r-simmer/simmer.mon">simmer.mon</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simmer-06-queueing_files/header-attrs-2.10/header-attrs.js"></script><script src="simmer-06-queueing_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Queueing Systems</h1>
                        <h4 class="author">Iñaki Ucar</h4>
            
            <h4 class="date">2021-08-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-simmer/simmer/blob/master/vignettes/simmer-06-queueing.Rmd"><code>vignettes/simmer-06-queueing.Rmd</code></a></small>
      <div class="hidden name"><code>simmer-06-queueing.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-simmer.org">simmer.plot</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></code></pre></div>
<div id="mmck-systems" class="section level2">
<h2 class="hasAnchor">
<a href="#mmck-systems" class="anchor"></a>M/M/c/k systems</h2>
<p>In Kendall’s notation, an M/M/c/k system has exponential arrivals (<strong>M</strong>/M/c/k), a <span class="math inline">\(c\)</span> servers (M/M/<strong>c</strong>/k) with exponential service time (M/<strong>M</strong>/c/k) and an <span class="math inline">\(k-c\)</span> positions in queue (M/M/c/<strong>k</strong>). For instance, a router may have several processors to handle packets, and the in/out queues are necessarily finite.</p>
<p>This is the simulation of an M/M/2/3 system (2 server, 1 position in queue). Note that the trajectory is identical to an M/M/1 system (one server, infinite queue).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">4</span>

<span class="va">m.queue</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"server"</span>, amount<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="st">"server"</span>, amount<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="va">mm23.env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"server"</span>, capacity<span class="op">=</span><span class="fl">2</span>, queue_size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"arrival"</span>, <span class="va">m.queue</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></code></pre></div>
<p>There are rejections when the queue is full.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">mm23.env</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">finished</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">finished</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.04253894</span></code></pre></div>
<p>By solving the balance equations for this system, we obtain the following:</p>
<p><span class="math display">\[
\begin{aligned}
p_0 &amp;= \left[ \sum_{n=0}^{c-1}\frac{r^n}{n!} + \sum_{n=c}^{k}\frac{r^n}{c!c^{n-c}} \right]^{-1}\\
N &amp;= \sum_{n=0}^{\infty}nP_n = p_0\left(\sum_{n=0}^{c-n}\frac{nr^n}{n!} + \sum_{n=c}^{k}\frac{nr^n}{c!c^{n-c}}\right)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(r=\lambda/\mu\)</span>. Finally, we can see how the simulation quickly converges to the theoretical average number of customers in the system <span class="math inline">\(N\)</span>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Theoretical value</span>
<span class="va">rho</span> <span class="op">&lt;-</span> <span class="va">lambda</span><span class="op">/</span><span class="va">mu</span>
<span class="va">div</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Special.html">factorial</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">mm23.N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span> <span class="op">*</span> <span class="va">rho</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">*</span> <span class="va">div</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rho</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">*</span> <span class="va">div</span><span class="op">)</span>

<span class="co"># Evolution of the average number of customers in the system</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">mm23.env</span><span class="op">)</span>, <span class="st">"usage"</span>, <span class="st">"server"</span>, items<span class="op">=</span><span class="st">"system"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">mm23.N</span><span class="op">)</span></code></pre></div>
<p><img src="simmer-06-queueing_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="custom-service-policies" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-service-policies" class="anchor"></a>Custom service policies</h2>
<p>Resources implement a FIFO (or FCFS) priority queue, which means that arrivals with a higher priority are processed first, and among those with the same priority, the first-in-first-out policy applies. These priorities can be statically assigned to all arrivals coming from a particular source (using the <code>priority</code> argument in <code><a href="../reference/add_generator.html">add_generator()</a></code> or a dedicated column in the data frame passed to <code><a href="../reference/add_dataframe.html">add_dataframe()</a></code>).</p>
<p>However, there is a useful activity to change priorities dynamically (as well as the other two prioritization values, <code>preemtible</code> and <code>restart</code>), and that is <code><a href="../reference/set_prioritization.html">set_prioritization()</a></code>. Such an activity allows us, for example, to implement a LIFO queue just by assigning an increasing priority to incoming arrivals:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">lifo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_attribute.html">set_global</a></span><span class="op">(</span><span class="st">"resource prio"</span>, <span class="fl">1</span>, mod<span class="op">=</span><span class="st">"+"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_prioritization.html">set_prioritization</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_n_generated.html">get_global</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"resource prio"</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"resource"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"processing"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="st">"resource"</span><span class="op">)</span>

<span class="va">env</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"resource"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"dummy"</span>, <span class="va">lifo</span>, <span class="fu"><a href="../reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 0: dummy0: processing</span>
<span class="co">#&gt; 5: dummy4: processing</span>
<span class="co">#&gt; 10: dummy3: processing</span>
<span class="co">#&gt; 15: dummy2: processing</span>
<span class="co">#&gt; 20: dummy1: processing</span></code></pre></div>
<p>This mechanism, together with signaling, serves as the basis to implement any custom servicing policy. The main idea is to signal whenever an arrival is going to release the resource so that all the arrivals in the queue can leave the queue momentarily to recompute their priorities:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"arrival time"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="../reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/renege.html">renege_if</a></span><span class="op">(</span>
    <span class="st">"recompute priority"</span>,
    out <span class="op">=</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="co"># e.g., increase priority if wait_time &lt; 3</span>
      <span class="fu"><a href="../reference/set_prioritization.html">set_prioritization</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="../reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"arrival time"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span>
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>     <span class="co"># only change the priority</span>
        <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span> <span class="co"># don't change anything</span>
      <span class="op">}</span>, mod<span class="op">=</span><span class="st">"+"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="co"># go 2 steps back to renege_if</span>
      <span class="fu"><a href="../reference/rollback.html">rollback</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"resource"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/renege.html">renege_abort</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"processing"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># trigger this before releasing the resource</span>
  <span class="fu"><a href="../reference/send.html">send</a></span><span class="op">(</span><span class="st">"recompute priority"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="st">"resource"</span><span class="op">)</span>

<span class="va">env</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"resource"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"dummy"</span>, <span class="va">custom</span>, <span class="fu"><a href="../reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 0: dummy0: processing</span>
<span class="co">#&gt; 5: dummy3: processing</span>
<span class="co">#&gt; 10: dummy4: processing</span>
<span class="co">#&gt; 15: dummy1: processing</span>
<span class="co">#&gt; 20: dummy2: processing</span></code></pre></div>
<p>Note that a null timeout was added so that the resource is released in the last place. In this way, all arrivals recompute their priorities and enter the queue again before the resource is released.</p>
</div>
<div id="state-dependent-service-rates" class="section level2">
<h2 class="hasAnchor">
<a href="#state-dependent-service-rates" class="anchor"></a>State-dependent service rates</h2>
<p>In many practical queueing scenarios, the speed of the server depends on the state of the system. Here we consider a multi-server resource that is able to distribute the processing capacity evenly among the arrivals. This means that if, for example, <code>capacity=2</code> and there is a single arrival in the server, it would be served twice as fast.</p>
<p>In terms of a simulation model, a state-dependent service rate implies that the time spent in the server must be asynchronously updated each time an arrival seizes or releases the resource. In consequence, first we need to define a trajectory that updates a running service delay and restarts the new time left to release the resource. The following trajectory assumes that three attributes are available:</p>
<ul>
<li>
<code>start</code>: simulation time at which the arrival started the last <code>timeout</code> activity.</li>
<li>
<code>multiplier</code>: distribution of the processing capacity.</li>
<li>
<code>delay</code>: service delay applied to the last <code>timeout</code> activity.</li>
</ul>
<p>The new delay is the time left scaled by the last and new multipliers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">update.delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"multiplier"</span>, <span class="st">"delay"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># previous multiplier, service time left</span>
    <span class="va">multiplier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"multiplier"</span><span class="op">)</span>
    <span class="va">left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"delay"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="../reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>
    <span class="co"># distribute processing capacity</span>
    <span class="va">new_multiplier</span> <span class="op">&lt;-</span> <span class="va">capacity</span> <span class="op">/</span> <span class="fu"><a href="../reference/get_capacity.html">get_server_count</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"sd.server"</span><span class="op">)</span>
    <span class="co"># return new values</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>, <span class="va">new_multiplier</span>, <span class="va">left</span> <span class="op">*</span> <span class="va">multiplier</span> <span class="op">/</span> <span class="va">new_multiplier</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/timeout.html">timeout_from_attribute</a></span><span class="op">(</span><span class="st">"delay"</span><span class="op">)</span></code></pre></div>
<p>The main trajectory below first seizes the server and initialises the three attributes. Then, the arrivals need to follow the <code>update.delay</code> trajectory and must be interrupted at any given time to re-run it, thus re-computing the service time left. In <code>simmer</code>, this can be done with some signaling (see <code><a href="../reference/send.html">help(trap)</a></code>): a signal is subscribed and <code>update.delay</code> is registered as a handler. The first <code>send</code> signals the arriving entity, causing all the arrivals to execute the handler. Eventually, the handler finishes and the execution path returns to unregister the handler, release the server and signal the departing entity.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd.queue</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"sd.server"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># initialisation</span>
  <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"multiplier"</span>, <span class="st">"delay"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># set the handler and trigger it</span>
  <span class="fu"><a href="../reference/send.html">trap</a></span><span class="op">(</span><span class="st">"update delay"</span>, handler<span class="op">=</span><span class="va">update.delay</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/send.html">send</a></span><span class="op">(</span><span class="st">"update delay"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># returning point</span>
  <span class="fu"><a href="../reference/send.html">untrap</a></span><span class="op">(</span><span class="st">"update delay"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="st">"sd.server"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/send.html">send</a></span><span class="op">(</span><span class="st">"update delay"</span><span class="op">)</span></code></pre></div>
<p>In the following, we compare an M/M/2 with this state-dependent system. Both systems are fed with the same interarrival times and, as expected, the average resource usage is significantly reduced.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">capacity</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">arrivals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">*</span><span class="va">lambda</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span>

<span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># M/M/2</span>
  <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"server"</span>, <span class="va">capacity</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_dataframe.html">add_dataframe</a></span><span class="op">(</span><span class="st">"arrival"</span>, <span class="va">m.queue</span>, <span class="va">arrivals</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># state-dependent service rate</span>
  <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"sd.server"</span>, <span class="va">capacity</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_dataframe.html">add_dataframe</a></span><span class="op">(</span><span class="st">"sd.arrival"</span>, <span class="va">sd.queue</span>, <span class="va">arrivals</span><span class="op">)</span>

<span class="va">env</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>metric<span class="op">=</span><span class="st">"usage"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"server"</span>, <span class="st">"sd.server"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="simmer-06-queueing_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="queueing-networks" class="section level2">
<h2 class="hasAnchor">
<a href="#queueing-networks" class="anchor"></a>Queueing Networks</h2>
<p>Let us consider the following network of queues (example taken from <a href="https://www.grotto-networking.com/DiscreteEventPython.html#NetQueues">Grotto Networking</a>):</p>
<div class="figure">
<img src="includes/queueing-network.svg" alt=""><p class="caption">A network of queues.</p>
</div>
<p>There are three exponential generators (<span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>, <span class="math inline">\(\lambda_4\)</span>) that inject messages with exponential size of mean 100 bytes. There are four M/D/1 queues with a deterministic rate equal to 220 bytes/s. There is a 25% probability that messages from <span class="math inline">\(\lambda_1\)</span> are dropped before the second queue, and a fork 35/65% for the output of the second queue to reach queues 3 and 4. We are interested, for instance, in the accumulated waiting time for messages entering queue 1 and exiting queue 3 or 4.</p>
<p>We’ll start by setting up the main constants and a couple of functions to set the message size and seize an M/D/1 queue:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_pkt_size</span> <span class="op">&lt;-</span> <span class="fl">100</span>        <span class="co"># bytes</span>
<span class="va">lambda1</span> <span class="op">&lt;-</span> <span class="fl">2</span>                <span class="co"># pkts/s</span>
<span class="va">lambda3</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>              <span class="co"># pkts/s</span>
<span class="va">lambda4</span> <span class="op">&lt;-</span> <span class="fl">0.6</span>              <span class="co"># pkts/s</span>
<span class="va">rate</span> <span class="op">&lt;-</span> <span class="fl">2.2</span> <span class="op">*</span> <span class="va">mean_pkt_size</span> <span class="co"># bytes/s</span>

<span class="co"># set an exponential message size of mean mean_pkt_size</span>
<span class="va">set_msg_size</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
  <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"size"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">/</span><span class="va">mean_pkt_size</span><span class="op">)</span><span class="op">)</span>

<span class="co"># seize an M/D/1 queue by id; the timeout is function of the message size</span>
<span class="va">md1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.</span>, <span class="va">id</span><span class="op">)</span>
  <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"md1_"</span>, <span class="va">id</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="../reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"size"</span><span class="op">)</span> <span class="op">/</span> <span class="va">rate</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"md1_"</span>, <span class="va">id</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>The next step is to set up the three points of attachment for our generators:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">to_queue_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_msg_size</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">md1</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/renege.html">leave</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">md1</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/branch.html">branch</a></span><span class="op">(</span>
    <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.65</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, continue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">F</span>, <span class="cn">F</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">md1</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,
    <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">md1</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">to_queue_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_msg_size</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">md1</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>

<span class="va">to_queue_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">set_msg_size</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">md1</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>Finally, we prepare and run the simulation environment with the resources and generators required:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="va">env</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"md1_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>
<span class="va">env</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"arrival1_"</span>, <span class="va">to_queue_1</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda1</span><span class="op">)</span>, mon<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"arrival3_"</span>, <span class="va">to_queue_3</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda3</span><span class="op">)</span>, mon<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"arrival4_"</span>, <span class="va">to_queue_4</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda4</span><span class="op">)</span>, mon<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="fl">4000</span><span class="op">)</span>
<span class="co">#&gt; simmer environment: anonymous | now: 4000 | next: 4000.0322040152</span>
<span class="co">#&gt; { Monitor: in memory }</span>
<span class="co">#&gt; { Resource: md1_1 | monitored: TRUE | server status: 1(1) | queue status: 0(Inf) }</span>
<span class="co">#&gt; { Resource: md1_2 | monitored: TRUE | server status: 1(1) | queue status: 3(Inf) }</span>
<span class="co">#&gt; { Resource: md1_3 | monitored: TRUE | server status: 1(1) | queue status: 0(Inf) }</span>
<span class="co">#&gt; { Resource: md1_4 | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }</span>
<span class="co">#&gt; { Source: arrival1_ | monitored: 2 | n_generated: 8079 }</span>
<span class="co">#&gt; { Source: arrival3_ | monitored: 2 | n_generated: 2044 }</span>
<span class="co">#&gt; { Source: arrival4_ | monitored: 2 | n_generated: 2402 }</span></code></pre></div>
<p>In the analysis, we filter arrivals from generator 1 that reach queues 3 and 4, and we examine the average waiting time and the total number of messages:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env</span>, per_resource <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">resource</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"md1_3"</span>, <span class="st">"md1_4"</span><span class="op">)</span>, select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"resource"</span><span class="op">)</span><span class="op">)</span>

<span class="va">arr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>waiting_time <span class="op">=</span> <span class="va">end_time</span> <span class="op">-</span> <span class="op">(</span><span class="va">start_time</span> <span class="op">+</span> <span class="va">activity_time</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>generator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="st">"arrival[[:digit:]]"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">waiting_time</span> <span class="op">~</span> <span class="va">generator</span> <span class="op">+</span> <span class="va">resource</span>, <span class="va">arr</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   generator resource waiting_time</span>
<span class="co">#&gt; 1  arrival1    md1_3    5.1816915</span>
<span class="co">#&gt; 2  arrival3    md1_3    0.6969347</span>
<span class="co">#&gt; 3  arrival1    md1_4    4.9417576</span>
<span class="co">#&gt; 4  arrival4    md1_4    0.4751263</span>
<span class="fu"><a href="../reference/get_n_generated.html">get_n_generated</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"arrival1_"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/get_n_generated.html">get_n_generated</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"arrival4_"</span><span class="op">)</span>
<span class="co">#&gt; [1] 10481</span>
<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">waiting_time</span> <span class="op">~</span> <span class="va">generator</span> <span class="op">+</span> <span class="va">resource</span>, <span class="va">arr</span>, <span class="va">length</span><span class="op">)</span>
<span class="co">#&gt;   generator resource waiting_time</span>
<span class="co">#&gt; 1  arrival1    md1_3         3867</span>
<span class="co">#&gt; 2  arrival3    md1_3         2042</span>
<span class="co">#&gt; 3  arrival1    md1_4         2166</span>
<span class="co">#&gt; 4  arrival4    md1_4         2401</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iñaki Ucar, Bart Smeets.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
