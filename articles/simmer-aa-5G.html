<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Advanced use cases and techniques for telecommunications.
">
<title>Design and Analysis of 5G Scenarios • simmer | DES for R</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Design and Analysis of 5G Scenarios">
<meta property="og:description" content="Advanced use cases and techniques for telecommunications.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115358925-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115358925-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">simmer | DES for R</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.4.6.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-gears"></span>
     
    Reference
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">
    <span class="fa fa-graduation-cap"></span>
     
    Articles
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-simmer/simmer">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--">
    <span class="fa fa-puzzle-piece"></span>
     
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--">
    <a class="dropdown-item" href="../extensions/plot">simmer.plot</a>
    <a class="dropdown-item" href="../extensions/bricks">simmer.bricks</a>
    <a class="external-link dropdown-item" href="https://github.com/r-simmer/simmer.optim">simmer.optim</a>
    <a class="external-link dropdown-item" href="https://github.com/r-simmer/simmer.json">simmer.json</a>
    <a class="external-link dropdown-item" href="https://github.com/r-simmer/simmer.mon">simmer.mon</a>
  </div>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Design and Analysis of 5G Scenarios</h1>
                        <h4 data-toc-skip class="author">Iñaki Ucar,
José Alberto Hernández, Pablo Serrano, Arturo Azcorra</h4>
            
            <h4 data-toc-skip class="date">2024-07-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-simmer/simmer/blob/HEAD/vignettes/simmer-aa-5G.Rmd" class="external-link"><code>vignettes/simmer-aa-5G.Rmd</code></a></small>
      <div class="d-none name"><code>simmer-aa-5G.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<blockquote>
<p>Simulation frameworks are important tools for the analysis and design
of communication networks and protocols, but they can result extremely
costly and/or complex (for the case of very specialized tools), or too
naive and lacking proper features and support (for the case of ad-hoc
tools). In this paper, we present an analysis of three 5G scenarios
using <code>simmer</code>, a recent R package for discrete-event
simulation that sits between the above two paradigms. As our results
show, it provides a simple yet very powerful syntax, supporting the
efficient simulation of relatively complex scenarios at a low
implementation cost.</p>
</blockquote>
<p>This vignette contains the code associated to the article <em>Design
and Analysis of 5G Scenarios with <code>simmer</code>: An R Package for
Fast DES Prototyping</em> (see the <a href="https://arxiv.org/abs/1801.09664" class="external-link">draft version on arXiv</a>),
published in the IEEE Communications Magazine (see
<code>citation("simmer")</code>). Refer to the article for a full
description and analysis of each scenario.</p>
</div>
<div class="section level2">
<h2 id="crosshauling-of-fh-and-bh-traffic">Crosshauling of FH and BH traffic<a class="anchor" aria-label="anchor" href="#crosshauling-of-fh-and-bh-traffic"></a>
</h2>
<p>This scenario is motivated by the Cloud Radio Access Network (C-RAN)
paradigm, where the mobile base station functionality is split into
simple Remote Radio Heads (RRH), spread across the deployment and
connected by fiber to centralized (and possibly virtualized) Base-Band
Units (BBU), at the operators’ premises.</p>
<p>In this C-RAN paradigm, fronthaul (FH) traffic from the RRH has
stringent delay requirements, while backhaul (BH) traffic from the BBU
has mild delay requirements. In a general topology, such as the one
illustrated in the figure, packet switches will forward both types of
traffic. We use <code>simmer</code> to simulate the scenario and decide
whether introducing service differentiation might improve the ability to
fulfil the delivery guarantees of FH traffic.</p>
<div style="text-align:center">
<p><img src="includes/5G-1-scenario.png"></p>
</div>
<p>These are the configuration parameters considered:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fl">40e9</span>                                   <span class="co"># link capacity [bps]</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.75</span>                                 <span class="co"># utilization</span></span>
<span></span>
<span><span class="va">FH_EX</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">80</span> <span class="op">+</span> <span class="fl">46</span><span class="op">)</span> <span class="op">*</span> <span class="fl">8</span> <span class="op">/</span> <span class="va">C</span>                  <span class="co"># avg. FH interarrival time [s]</span></span>
<span><span class="va">BH_bytes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">576</span>, <span class="fl">1500</span><span class="op">)</span>                <span class="co"># BH traffic distribution</span></span>
<span><span class="va">Weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">12</span>                  <span class="co">#</span></span>
<span><span class="va">BH_EX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Weights</span> <span class="op">*</span> <span class="op">(</span><span class="fl">8</span> <span class="op">*</span> <span class="va">BH_bytes</span> <span class="op">/</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span>  <span class="co"># avg. BH interarrival time [s]</span></span>
<span></span>
<span><span class="va">FH_w</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>                                 <span class="co"># FH traffic ratio</span></span>
<span><span class="va">BH_w</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">FH_w</span>                            <span class="co"># BH traffic ratio</span></span>
<span><span class="va">FH_lambda</span> <span class="op">&lt;-</span> <span class="va">FH_w</span> <span class="op">*</span> <span class="va">rho</span> <span class="op">/</span> <span class="va">FH_EX</span>             <span class="co"># FH avg. rate [pkts/s]</span></span>
<span><span class="va">BH_lambda</span> <span class="op">&lt;-</span> <span class="va">BH_w</span> <span class="op">*</span> <span class="va">rho</span> <span class="op">/</span> <span class="va">BH_EX</span>             <span class="co"># BH avg. rate [pkts/s]</span></span>
<span></span>
<span><span class="va">Tsim</span> <span class="op">&lt;-</span> <span class="fl">1e5</span> <span class="op">/</span> <span class="op">(</span><span class="va">FH_lambda</span> <span class="op">+</span> <span class="va">BH_lambda</span><span class="op">)</span>       <span class="co"># simulation time</span></span></code></pre></div>
<p>The model is defined and encapsulated into the <code>simulate</code>
function. Then, several scenarios with different parameters are defined
in <code>cases</code>, which can be run in parallel:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parametrized simulation function</span></span>
<span><span class="co"># - param[["n_switch"]] is the number of switches</span></span>
<span><span class="co"># - param[["fh_prio"]] is the priority level for FH traffic</span></span>
<span><span class="co"># - param[["preemptive"]] is the preemptiveness flag for switches</span></span>
<span><span class="va">simulate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># single FH traffic trajectory traversing n_switch elements sequentially</span></span>
<span>  <span class="va">fh_traffic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">param</span><span class="op">[[</span><span class="st">"n_switch"</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"switch"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">FH_EX</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"switch"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/join.html">join</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># list of n_switch trajectories, one per element, modeling the interfering BH traffic</span></span>
<span>  <span class="va">bh_traffic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">param</span><span class="op">[[</span><span class="st">"n_switch"</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"switch"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">BH_bytes</span><span class="op">*</span><span class="fl">8</span><span class="op">/</span><span class="va">C</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="va">Weights</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"switch"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># simulation environment</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># generator of FH traffic</span></span>
<span>    <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"FH_0_"</span>, <span class="va">fh_traffic</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">FH_lambda</span><span class="op">)</span>, priority<span class="op">=</span><span class="va">param</span><span class="op">[[</span><span class="st">"fh_prio"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">param</span><span class="op">[[</span><span class="st">"n_switch"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="co"># n_switch resources, one per switch</span></span>
<span>      <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"switch"</span>, <span class="va">i</span><span class="op">)</span>, <span class="fl">1</span>, <span class="cn">Inf</span>, mon<span class="op">=</span><span class="cn">FALSE</span>, preemptive<span class="op">=</span><span class="va">param</span><span class="op">[[</span><span class="st">"preemptive"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="co"># n_switch generators of BH traffic</span></span>
<span>      <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"BH_"</span>, <span class="va">i</span>, <span class="st">"_"</span><span class="op">)</span>, <span class="va">bh_traffic</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">BH_lambda</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="va">Tsim</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/wrap.html">wrap</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># grid of scenarios</span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>n_switch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                     fh_prio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                     preemptive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parallel simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">cases</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span>, <span class="va">simulate</span>,</span>
<span>                             mc.cores<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, mc.set.seed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the information is extracted, summarised and represented in
a few lines of code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bp.vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">probs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs<span class="op">=</span><span class="va">probs</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ymin"</span>, <span class="st">"lower"</span>, <span class="st">"middle"</span>, <span class="st">"upper"</span>, <span class="st">"ymax"</span><span class="op">)</span></span>
<span>  <span class="va">r</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">arrivals</span> <span class="op">&lt;-</span> <span class="va">envs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span><span class="va">cases</span>, <span class="st">"replication"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">fh_prio</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">preemptive</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/batch.html">separate</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Flow"</span>, <span class="st">"index"</span>, <span class="st">"n"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total_time <span class="op">=</span> <span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span>,</span>
<span>         waiting_time <span class="op">=</span> <span class="va">total_time</span> <span class="op">-</span> <span class="va">activity_time</span>,</span>
<span>         Queue <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">fh_prio</span>, <span class="va">preemptive</span><span class="op">)</span>,</span>
<span>           <span class="st">"without SP"</span> <span class="op">=</span> <span class="st">"0.FALSE"</span>,</span>
<span>           <span class="st">"with SP"</span> <span class="op">=</span> <span class="st">"1.FALSE"</span>,</span>
<span>           <span class="st">"with SP &amp; preemption"</span> <span class="op">=</span> <span class="st">"1.TRUE"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">arrivals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_switch</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Queue</span>, <span class="va">waiting_time</span><span class="op">*</span><span class="fl">1e9</span>, color<span class="op">=</span><span class="va">Flow</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data<span class="op">=</span><span class="va">bp.vals</span>, geom<span class="op">=</span><span class="st">"boxplot"</span>, position<span class="op">=</span><span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.justification<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.02</span>, <span class="fl">.98</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Queueing Delay [ns]"</span>, x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">arrivals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flow</span> <span class="op">==</span> <span class="st">"FH"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">n_switch</span><span class="op">)</span>, <span class="va">waiting_time</span><span class="op">*</span><span class="fl">1e9</span>, color<span class="op">=</span><span class="va">Queue</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data<span class="op">=</span><span class="va">bp.vals</span>, geom<span class="op">=</span><span class="st">"boxplot"</span>, position<span class="op">=</span><span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.justification<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.02</span>, <span class="fl">.98</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Queueing Delay [ns]"</span>, x <span class="op">=</span> <span class="st">"No. of switches"</span><span class="op">)</span></span></code></pre></div>
<div style="text-align:center">
<p><img src="includes/5G-1-results-a.png" style="width:47.0%"><img src="includes/5G-1-results-b.png" style="width:47.0%"></p>
</div>
</div>
<div class="section level2">
<h2 id="mobile-traffic-backhauling-with-fttx">Mobile traffic backhauling with FTTx<a class="anchor" aria-label="anchor" href="#mobile-traffic-backhauling-with-fttx"></a>
</h2>
<p>We next consider the case of a residencial area with a
Fiber-To-The-Premises (FTTx) infrastructure, that is, an Optical
Distribution Network (ODN), composed of the Optical Line Terminal (OLT),
splitters, and the Optical Network Unit (ONU) at the users’ premises. As
the figure illustrates, we assume that an operator is planning to deploy
an antenna, carrying the mobile traffic over the ODN, and is considering
two implementation options:</p>
<ul>
<li>Deployment of a Small Cell, reducing the amount and requirements of
the generated traffic.</li>
<li>Deployment of an RRH, following the C-RAN paradigm discussed above,
which would therefore generate time-sensitive FH traffic.</li>
</ul>
<p>In both cases, we analyze the upstream channel of a Time-Division
Multiplexed Passive Optical Network (TDM-PON) providing broadband access
to the residential users and the mobile users.</p>
<div style="text-align:center">
<p><img src="includes/5G-2-scenario.png"></p>
</div>
<p>These are the configuration parameters considered:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fl">1.25e9</span>                           <span class="co"># link capacity [bps]</span></span>
<span><span class="va">Tg</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span>                            <span class="co"># guard time [s]</span></span>
<span></span>
<span><span class="va">bytes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">576</span>, <span class="fl">1500</span><span class="op">)</span>             <span class="co"># traffic distribution</span></span>
<span><span class="va">Weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">12</span>            <span class="co">#</span></span>
<span><span class="va">EX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Weights</span> <span class="op">*</span> <span class="op">(</span><span class="fl">8</span> <span class="op">*</span> <span class="va">bytes</span> <span class="op">/</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span>  <span class="co"># avg. interarrival time [s]</span></span>
<span><span class="va">burst</span> <span class="op">&lt;-</span> <span class="fl">20</span>                           <span class="co"># burst length [pkts]</span></span>
<span></span>
<span><span class="va">ONU_lambda</span> <span class="op">&lt;-</span> <span class="fl">20e6</span> <span class="op">/</span> <span class="va">C</span> <span class="op">/</span> <span class="va">EX</span>           <span class="co"># avg. rate per ONU [pkts/s]</span></span>
<span><span class="va">SC_lambda</span> <span class="op">&lt;-</span> <span class="fl">150e6</span> <span class="op">/</span> <span class="va">C</span> <span class="op">/</span> <span class="va">EX</span>           <span class="co"># avg. rate for the SC [pkts/s]</span></span>
<span><span class="va">RRH_on</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="op">*</span> <span class="fl">6000</span> <span class="op">/</span> <span class="va">C</span>                <span class="co"># RRH on period [s]</span></span>
<span><span class="va">RRH_period</span> <span class="op">&lt;-</span> <span class="va">RRH_on</span> <span class="op">*</span> <span class="va">C</span> <span class="op">/</span> <span class="fl">720e6</span>      <span class="co"># RRH total period [s]</span></span>
<span><span class="va">RRH_off</span> <span class="op">&lt;-</span> <span class="va">RRH_period</span> <span class="op">-</span> <span class="va">RRH_on</span>        <span class="co"># RRH off period [s]</span></span></code></pre></div>
<p>The model is defined and encapsulated into the <code>simulate</code>
function. Then, several scenarios with different parameters are defined
in <code>cases</code>, which can be run in parallel:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># helper function: round-robin-based selection of ONUs</span></span>
<span><span class="va">cyclic_counter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">op</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="va">op</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;</span> <span class="va">n</span><span class="op">)</span> <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">n</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">i</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># helper function: generator of packet sizes of n packets</span></span>
<span><span class="va">gen_pkts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">bytes</span><span class="op">*</span><span class="fl">8</span><span class="op">/</span><span class="va">C</span>, size<span class="op">=</span><span class="va">n</span>, prob<span class="op">=</span><span class="va">Weights</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># helper function: double-exponential generator of interarrival times</span></span>
<span><span class="va">gen_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span>, <span class="va">burst</span><span class="op">)</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span><span class="op">/</span><span class="va">burst</span>, <span class="va">lambda</span><span class="op">/</span><span class="va">burst</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">burst</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parametrized simulation function</span></span>
<span><span class="co"># - param[["scenario"]] is the scenario identifier (A=small cell, B=RRH)</span></span>
<span><span class="co"># - param[["ONU_n"]] is the number of ONUs</span></span>
<span><span class="co"># - param[["limit"]] is the max. transmission window</span></span>
<span><span class="va">simulate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># global variables</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ONU_lambda</span>, <span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">param</span><span class="op">[[</span><span class="st">"limit"</span><span class="op">]</span><span class="op">]</span>, <span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">8</span> <span class="op">/</span> <span class="va">C</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">param</span><span class="op">[[</span><span class="st">"scenario"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lambda</span>, <span class="va">SC_lambda</span><span class="op">)</span></span>
<span>    <span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">limit</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>    <span class="va">tx_t</span> <span class="op">&lt;-</span> <span class="va">RRH_on</span> <span class="op">+</span> <span class="va">Tg</span> <span class="op">+</span> <span class="va">Tg</span> <span class="op">*</span> <span class="fl">0</span><span class="op">:</span><span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">Tg_n</span> <span class="op">&lt;-</span> <span class="va">RRH_off</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="va">Tg</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>    <span class="va">Tg_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Tg_n</span>, length.out<span class="op">=</span><span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">period_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span>, each<span class="op">=</span><span class="va">Tg_n</span>, length.out<span class="op">=</span><span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">tx_t</span> <span class="op">&lt;-</span> <span class="va">RRH_on</span> <span class="op">+</span> <span class="va">RRH_period</span> <span class="op">*</span> <span class="va">period_i</span> <span class="op">+</span> <span class="va">Tg</span> <span class="op">*</span> <span class="va">Tg_i</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">eq_pkts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>, <span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">tx_pkts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>, <span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">t_head</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">tx_t</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">onu_i</span> <span class="op">&lt;-</span> <span class="fu">cyclic_counter</span><span class="op">(</span><span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">remaining</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span></span>
<span>  <span class="co"># DBA logic</span></span>
<span>  <span class="va">set_next_window</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># time until the next RRH_on</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">param</span><span class="op">[[</span><span class="st">"scenario"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span></span>
<span>      <span class="va">remaining</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">t_head</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="va">RRH_period</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">RRH_period</span> <span class="op">-</span> <span class="va">t_head</span></span>
<span>    <span class="co"># generate new pkt lengths</span></span>
<span>    <span class="va">pkts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_capacity.html">get_queue_count</a></span><span class="op">(</span><span class="va">env</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ONU"</span>, <span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">eq_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">eq_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="fu">gen_pkts</span><span class="op">(</span><span class="va">pkts</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">eq_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># reserve the next transmission window</span></span>
<span>    <span class="va">eq_cumsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">eq_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">eq_cumsum</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">limit</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="va">remaining</span> <span class="op">-</span> <span class="va">Tg</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">pkts</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">n</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="va">remaining</span> <span class="op">&lt;=</span> <span class="va">Tg</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># go past the next RRH_on</span></span>
<span>      <span class="va">t_head</span> <span class="op">&lt;&lt;-</span> <span class="va">t_head</span> <span class="op">+</span> <span class="va">remaining</span> <span class="op">+</span> <span class="va">RRH_on</span> <span class="op">+</span> <span class="va">Tg</span></span>
<span>      <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">eq_cumsum</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">limit</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="va">RRH_off</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">Tg</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">tx_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">eq_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">eq_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">eq_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">tx_t</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="va">t_head</span></span>
<span>    <span class="va">t_head</span> <span class="op">&lt;&lt;-</span> <span class="va">t_head</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tx_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">Tg</span></span>
<span>    <span class="va">index</span> <span class="op">&lt;&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">tx_t</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="../reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># list of ONU_n trajectories, one per ONU</span></span>
<span>  <span class="va">ONUs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ONU"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/set_capacity.html">set_capacity</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ONU"</span>, <span class="va">i</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"link"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">index</span> <span class="op">&lt;&lt;-</span> <span class="va">index</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>        <span class="va">tx_pkts</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">index</span><span class="op">]</span></span>
<span>      <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="st">"link"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ONU"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># OLT logic</span></span>
<span>  <span class="va">OLT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">simmer</span><span class="fu">::</span><span class="fu"><a href="../reference/select.html">select</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ONU"</span>, <span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"ONU"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/set_capacity.html">set_capacity_selected</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tx_pkts</span><span class="op">[[</span><span class="fu">onu_i</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">set_next_window</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/rollback.html">rollback</a></span><span class="op">(</span>amount<span class="op">=</span><span class="fl">6</span>, times<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># RRH logic</span></span>
<span>  <span class="va">RRH</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"link"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">RRH_on</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/seize.html">release</a></span><span class="op">(</span><span class="st">"link"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">RRH_off</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/rollback.html">rollback</a></span><span class="op">(</span>amount<span class="op">=</span><span class="fl">4</span>, times<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># simulation environment</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># the fiber link as a resource</span></span>
<span>    <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"link"</span>, <span class="fl">1</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">param</span><span class="op">[[</span><span class="st">"scenario"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span></span>
<span>    <span class="co"># RRH worker</span></span>
<span>    <span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"RRH_"</span>, <span class="va">RRH</span>, <span class="fu"><a href="../reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">param</span><span class="op">[[</span><span class="st">"ONU_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="co"># ONU_n resources, one per ONU</span></span>
<span>      <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ONU"</span>, <span class="va">i</span><span class="op">)</span>, <span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="co"># ONU_n traffic generators, one per ONU</span></span>
<span>      <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ONU_"</span>, <span class="va">i</span>, <span class="st">"_"</span><span class="op">)</span>, <span class="va">ONUs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="fu">gen_exp</span><span class="op">(</span><span class="va">lambda</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">burst</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># OLT worker</span></span>
<span>    <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"token_"</span>, <span class="va">OLT</span>, <span class="fu"><a href="../reference/generators.html">at</a></span><span class="op">(</span><span class="va">RRH_on</span> <span class="op">+</span> <span class="va">Tg</span><span class="op">)</span>, mon<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="fl">1e5</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/wrap.html">wrap</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># grid of scenarios</span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    ONU_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fl">1500</span>, <span class="fl">3000</span>, <span class="fl">6000</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parallel simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">cases</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span>, <span class="va">simulate</span>,</span>
<span>                             mc.cores<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, mc.set.seed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the information is extracted, summarised and represented in
a few lines of code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bp.vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">probs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs<span class="op">=</span><span class="va">probs</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ymin"</span>, <span class="st">"lower"</span>, <span class="st">"middle"</span>, <span class="st">"upper"</span>, <span class="st">"ymax"</span><span class="op">)</span></span>
<span>  <span class="va">r</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">envs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span><span class="va">cases</span>, <span class="st">"replication"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span></span>
<span>    <span class="va">scenario</span>, `SmallCell + 31 ONUs`<span class="op">=</span><span class="st">"A"</span>, `RRH + 7 ONUs`<span class="op">=</span><span class="st">"B"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/batch.html">separate</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flow"</span>, <span class="st">"index"</span>, <span class="st">"n"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flow <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">index</span> <span class="op">==</span> <span class="va">ONU_n</span><span class="op">+</span><span class="fl">1</span>, <span class="st">"SmallCell"</span>, <span class="va">flow</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total_time <span class="op">=</span> <span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span>,</span>
<span>         waiting_time <span class="op">=</span> <span class="va">total_time</span> <span class="op">-</span> <span class="va">activity_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span>, <span class="va">waiting_time</span><span class="op">*</span><span class="fl">1e6</span>, color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">scenario</span>, scales<span class="op">=</span><span class="st">"free"</span>, space<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data<span class="op">=</span><span class="va">bp.vals</span>, geom<span class="op">=</span><span class="st">"boxplot"</span>, position<span class="op">=</span><span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.justification<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.02</span>, <span class="fl">.98</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Queueing Delay ["</span>, <span class="va">mu</span>, <span class="st">"s]"</span><span class="op">)</span><span class="op">)</span>, x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Limit [bytes]"</span><span class="op">)</span></span></code></pre></div>
<div style="text-align:center">
<p><img src="includes/5G-2-results.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="energy-efficiency-for-massive-iot">Energy efficiency for massive IoT<a class="anchor" aria-label="anchor" href="#energy-efficiency-for-massive-iot"></a>
</h2>
<p>Finally, we consider the case of a massive Internet-of-Things (mIoT)
scenario, a use case for Long Term Evolution (LTE) and next-generation
5G networks, as defined by the Third Generation Partnership Project
(3GPP). As the figure (left) illustrates, we consider a single LTE
macrocell in a dense urban area. The buildings in the cell area are
populated with <span class="math inline">\(N\)</span> smart meters (for
electricity, gas and water), and each meter operates independently as a
Narrowband IoT (NB-IoT) device. The devices’ behaviour is modeled
following the diagram depicted in the figure (right).</p>
<div style="text-align:center">
<p><img src="includes/5G-3-scenario.png"></p>
</div>
<p>These are the configuration parameters considered:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">9</span>            <span class="co"># number of RA retries</span></span>
<span><span class="va">Ps</span> <span class="op">&lt;-</span> <span class="fl">0.03</span>        <span class="co"># sleep power consumption [mW]</span></span>
<span><span class="va">Pi</span> <span class="op">&lt;-</span> <span class="fl">10</span>          <span class="co"># idle power consumption [mW]</span></span>
<span><span class="va">Prx</span> <span class="op">&lt;-</span> <span class="fl">100</span>        <span class="co"># rx power consumption [mW]</span></span>
<span><span class="va">Prbp</span> <span class="op">&lt;-</span> <span class="fl">32.18</span>     <span class="co"># tx power consumption per RB pair [mW]</span></span>
<span><span class="va">Ppre</span> <span class="op">&lt;-</span> <span class="fl">32.18</span>     <span class="co"># preamble tx power consumption [mW]</span></span>
<span></span>
<span><span class="va">Tbpre</span> <span class="op">&lt;-</span> <span class="fl">0.0025</span>   <span class="co"># time before preamble transmission [s]</span></span>
<span><span class="va">Tpre</span> <span class="op">&lt;-</span> <span class="fl">0.0014</span>    <span class="co"># time for preamble transmission [s]</span></span>
<span><span class="va">Trarx</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>     <span class="co"># rx time to perform RA [s]</span></span>
<span><span class="va">Tcrcp</span> <span class="op">&lt;-</span> <span class="fl">0.016</span>    <span class="co"># sum of processing delays to establish a connection [s]</span></span>
<span><span class="va">Twait</span> <span class="op">&lt;-</span> <span class="fl">0.054</span>    <span class="co"># S1 processing and transfer delay [s]</span></span>
<span></span>
<span><span class="va">Brbp</span> <span class="op">&lt;-</span> <span class="fl">36</span>        <span class="co"># bytes per RB pair (QPSK modulation)</span></span>
<span><span class="va">Breq</span> <span class="op">&lt;-</span> <span class="fl">7</span>         <span class="co"># RRC request message size (bytes)</span></span>
<span><span class="va">Bcompcp</span> <span class="op">&lt;-</span> <span class="fl">129</span>    <span class="co"># RRC setup complete + NAS control plane SR + data for CP (bytes)</span></span>
<span></span>
<span><span class="va">Tra</span> <span class="op">&lt;-</span> <span class="va">Tbpre</span> <span class="op">+</span> <span class="va">Trarx</span> <span class="op">+</span> <span class="va">Tpre</span></span>
<span><span class="va">Pra</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Tbpre</span><span class="op">*</span><span class="va">Pi</span> <span class="op">+</span> <span class="va">Trarx</span><span class="op">*</span><span class="va">Prx</span> <span class="op">+</span> <span class="va">Tpre</span><span class="op">*</span><span class="va">Ppre</span><span class="op">)</span> <span class="op">/</span> <span class="va">Tra</span></span>
<span><span class="va">rbs</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">Breq</span><span class="op">/</span><span class="va">Brbp</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">Bcompcp</span><span class="op">/</span><span class="va">Brbp</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-3</span></span>
<span><span class="va">Ttx</span> <span class="op">&lt;-</span> <span class="va">Tcrcp</span> <span class="op">+</span> <span class="va">rbs</span> <span class="op">+</span> <span class="va">Twait</span></span>
<span><span class="va">Ptx</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Tcrcp</span><span class="op">*</span><span class="va">Prx</span> <span class="op">+</span> <span class="va">rbs</span><span class="op">*</span><span class="va">Prbp</span> <span class="op">+</span> <span class="va">Twait</span><span class="op">*</span><span class="va">Prx</span><span class="op">)</span> <span class="op">/</span> <span class="va">Ttx</span></span>
<span></span>
<span><span class="va">tx_period</span> <span class="op">&lt;-</span> <span class="fl">3600</span> <span class="co"># time between transmissions (seconds)</span></span>
<span><span class="va">Tsim</span> <span class="op">&lt;-</span> <span class="fl">24</span><span class="op">*</span><span class="fl">3600</span>   <span class="co"># simulation time (seconds)</span></span></code></pre></div>
<p>The model is defined and encapsulated into the <code>simulate</code>
function. Then, several scenarios with different parameters are defined
in <code>cases</code>, which can be run in parallel:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parametrized simulation function</span></span>
<span><span class="co"># - param[["meter_n"]] is the number of IoT devices in the cell</span></span>
<span><span class="co"># - param[["backoff"]] is the backoff time</span></span>
<span><span class="va">simulate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># identifiers for RA preambles</span></span>
<span>  <span class="va">preambles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"preamble_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">54</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># IoT device logic</span></span>
<span>  <span class="va">meter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/send.html">trap</a></span><span class="op">(</span><span class="st">"reading"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># sleep</span></span>
<span>    <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/send.html">wait</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">param</span><span class="op">[[</span><span class="st">"backoff"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># ra start</span></span>
<span>    <span class="fu">simmer</span><span class="fu">::</span><span class="fu"><a href="../reference/select.html">select</a></span><span class="op">(</span><span class="va">preambles</span>, policy<span class="op">=</span><span class="st">"random"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/seize.html">seize_selected</a></span><span class="op">(</span></span>
<span>      continue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="co"># ra &amp; tx</span></span>
<span>      post.seize<span class="op">=</span><span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="va">Pra</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">Tra</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/seize.html">release_selected</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="va">Ptx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">Ttx</span><span class="op">)</span>,</span>
<span>      <span class="co"># ra &amp; backoff &amp; retry</span></span>
<span>      reject<span class="op">=</span><span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="va">Pra</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">Tra</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="va">Pi</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/rollback.html">rollback</a></span><span class="op">(</span><span class="fl">6</span>, times<span class="op">=</span><span class="va">m</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/rollback.html">rollback</a></span><span class="op">(</span><span class="fl">5</span>, times<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># trigger a reading for all the meters every tx_period</span></span>
<span>  <span class="va">trigger</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">tx_period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/send.html">send</a></span><span class="op">(</span><span class="st">"reading"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/rollback.html">rollback</a></span><span class="op">(</span><span class="fl">2</span>, times<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># simulation environment</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># IoT device workers</span></span>
<span>    <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"meter_"</span>, <span class="va">meter</span>, <span class="fu"><a href="../reference/generators.html">at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">param</span><span class="op">[[</span><span class="st">"meter_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, mon<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># trigger worker</span></span>
<span>    <span class="fu"><a href="../reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"trigger_"</span>, <span class="va">trigger</span>, <span class="fu"><a href="../reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, mon<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">preambles</span><span class="op">)</span></span>
<span>    <span class="co"># one resource per preamble</span></span>
<span>    <span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">1</span>, <span class="fl">0</span>, mon<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="va">Tsim</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/wrap.html">wrap</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># grid of scenarios</span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>meter_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5e3</span>, <span class="fl">1e4</span>, <span class="fl">3e4</span><span class="op">)</span>, backoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parallel simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">cases</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span>, <span class="va">simulate</span>,</span>
<span>                             mc.cores<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, mc.set.seed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the information is extracted, summarised and represented in
a few lines of code:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bp.vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">probs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs<span class="op">=</span><span class="va">probs</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ymin"</span>, <span class="st">"lower"</span>, <span class="st">"middle"</span>, <span class="st">"upper"</span>, <span class="st">"ymax"</span><span class="op">)</span></span>
<span>  <span class="va">r</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">envs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/get_mon.html">get_mon_attributes</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">replication</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>dE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">value</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span><span class="va">cases</span>, <span class="st">"replication"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">meter_n</span><span class="op">)</span>, <span class="va">dE</span><span class="op">*</span><span class="va">tx_period</span><span class="op">/</span><span class="va">Tsim</span>, color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">backoff</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data<span class="op">=</span><span class="va">bp.vals</span>, geom<span class="op">=</span><span class="st">"boxplot"</span>, position<span class="op">=</span><span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.justification<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.02</span>, <span class="fl">.98</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"Energy per Tx [mJ]"</span>, x<span class="op">=</span><span class="st">"No. of devices"</span>, color<span class="op">=</span><span class="st">"Backoff window [s]"</span><span class="op">)</span></span></code></pre></div>
<div style="text-align:center">
<p><img src="includes/5G-3-results.png"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Iñaki Ucar, Bart Smeets.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
