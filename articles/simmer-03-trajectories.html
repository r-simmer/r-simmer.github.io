<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Trajectory Usage • simmer</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">simmer | DES for R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">
    <span class="fa fa-gears"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simmer-01-introduction.html">Introduction to simmer</a>
    </li>
    <li>
      <a href="../articles/simmer-02-terminology.html">Terminology</a>
    </li>
    <li>
      <a href="../articles/simmer-03-trajectories.html">Advanced Trajectory Usage</a>
    </li>
    <li>
      <a href="../articles/simmer-04-bank-1.html">The Bank Tutorial: Part I</a>
    </li>
    <li>
      <a href="../articles/simmer-05-simpy.html">Other SimPy Examples</a>
    </li>
    <li>
      <a href="../articles/simmer-06-queueing-systems.html">Queueing Systems</a>
    </li>
    <li>
      <a href="../articles/simmer-07-ctmc.html">Continuous-Time Markov Chains</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Extensions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../extensions/plot">simmer.plot</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-simmer/simmer">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Advanced Trajectory Usage</h1>
                        <h4 class="author">Iñaki Ucar, Bart Smeets</h4>
            
            <h4 class="date">2017-05-30</h4>
          </div>

    
    
<div class="contents">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(simmer)
<span class="kw">library</span>(simmer.plot)</code></pre></div>
<div id="available-set-of-activities" class="section level2">
<h2 class="hasAnchor">
<a href="#available-set-of-activities" class="anchor"></a>Available set of activities</h2>
<p>When a generator creates an arrival, it couples the arrival to a given trajectory. A trajectory is defined as an interlinkage of activities which together form the arrivals’ lifetime in the system. Once an arrival is coupled to the trajectory, it will (in general) start processing the activities in the trajectory in the specified order and, eventually, leave the system. Consider the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="dt">resource =</span> <span class="st">"doctor"</span>, <span class="dt">amount =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dt">task =</span> <span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="dt">resource =</span> <span class="st">"doctor"</span>, <span class="dt">amount =</span> <span class="dv">1</span>)</code></pre></div>
<p>Here we create a trajectory where a patient <em>seizes</em> a doctor for 3 minutes and then <em>releases</em> him again.</p>
<p>This is a very straightforward example, however, most of the trajectory-related functions allow for more advanced usage. The different functions are introduced below.</p>
<div id="log_" class="section level3">
<h3 class="hasAnchor">
<a href="#log_" class="anchor"></a><code><a href="../reference/log_.html">log_()</a></code>
</h3>
<p>The <code>log_(., message</code>) method just prints a given message preceded by the simulation time and the name of the arrival, for debugging purposes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)

t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"hello world!"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"dummy"</span>, t, function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">5</span>) %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 2.50176: dummy0: hello world!</span>
<span class="co">#&gt; 2.74852: dummy1: hello world!</span>
<span class="co">#&gt; 2.7551: dummy2: hello world!</span>
<span class="co">#&gt; 4.49785: dummy3: hello world!</span>
<span class="co">#&gt; 4.88503: dummy4: hello world!</span>
<span class="co">#&gt; 4.97498: dummy5: hello world!</span></code></pre></div>
</div>
<div id="set_attribute" class="section level3">
<h3 class="hasAnchor">
<a href="#set_attribute" class="anchor"></a><code><a href="../reference/set_attribute.html">set_attribute()</a></code>
</h3>
<p>The <code><a href="../reference/set_attribute.html">set_attribute(., key, value, global)</a></code> method sets the <code>value</code> of an arrival’s attribute <code>key</code>. Be aware that <code>value</code> can only be numeric.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="dt">key =</span> <span class="st">"my_key"</span>, <span class="dt">value =</span> <span class="dv">123</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="dt">key =</span> <span class="st">"my_key"</span>, <span class="dt">value =</span> <span class="dv">456</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_attributes</a></span>(env)
<span class="co">#&gt;   time     name    key value replication</span>
<span class="co">#&gt; 1    0 patient0 my_key   123           1</span>
<span class="co">#&gt; 2    5 patient0 my_key   456           1</span></code></pre></div>
<p>Above, a trajectory which <em>only</em> sets attribute <code>my_key</code> to value <code>123</code> is launched once by an arrival generated at time 0 (check <code><a href="../reference/at.html">?at</a></code>). The <code>mon=2</code> of <code><a href="../reference/add_generator.html">add_generator()</a></code> makes the simulation environment monitor the attributes’ evolution (disabled by default). Using <code><a href="../reference/get_mon.html">get_mon_attributes()</a></code>, we can look at the evolution of the value of <code>my_key</code>.</p>
<p>If you want to set an attribute that depends on another attribute, or on the current value of the attribute to be set, this is also possible. In fact, if, instead of a numeric value, you supply a function with one parameter, the current set of attributes is passed as a list to that function. Whatever (numeric value) your function returns is set as the value of the specified attribute key. If the supplied function has no parameters, it is evaluated in the same way, but the attribute list is not accesible in the function body. This means that, if you supply a function to the <code>value</code> parameter, it has to be in the form of either <code>function(attrs){}</code> (first case) or <code>function(){}</code> (second case). Below, you can see an example of this in practice.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"my_key"</span>, <span class="dv">123</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"my_key"</span>, function(attrs) attrs[[<span class="st">"my_key"</span>]] +<span class="st"> </span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"dependent_key"</span>, function(attrs) <span class="kw">ifelse</span>(attrs[[<span class="st">"my_key"</span>]]&lt;=<span class="dv">123</span>, <span class="dv">1</span>, <span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"independent_key"</span>, function() <span class="kw">runif</span>(<span class="dv">1</span>))

env&lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_attributes</a></span>(env)
<span class="co">#&gt;   time     name             key       value replication</span>
<span class="co">#&gt; 1    0 patient0          my_key 123.0000000           1</span>
<span class="co">#&gt; 2    5 patient0          my_key 124.0000000           1</span>
<span class="co">#&gt; 3   10 patient0   dependent_key   0.0000000           1</span>
<span class="co">#&gt; 4   15 patient0 independent_key   0.9234335           1</span></code></pre></div>
<p>In general, whenever an activity accepts a function as a parameter, the rule above applies, and you can obtain the current set of attributes as the first argument of that function.</p>
<p>Attributes are <em>per arrival</em> by default (<code>global=FALSE</code>), meaning that each arrival has its own set of attributes, not visible by anyone else:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">writer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="dt">key =</span> <span class="st">"my_key"</span>, <span class="dt">value =</span> <span class="dv">123</span>)

reader &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(function(attr) <span class="kw">paste0</span>(attr[<span class="st">"my_key"</span>]))

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"writer"</span>, writer, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"reader"</span>, reader, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">1</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 1: reader0: NA</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_attributes</a></span>(env)
<span class="co">#&gt;   time    name    key value replication</span>
<span class="co">#&gt; 1    0 writer0 my_key   123           1</span></code></pre></div>
<p>Thus, the reader in the example above returns <code>NA</code>, missing. However, attributes can also be global with <code>global=TRUE</code>. To retrieve the global set of attributes in any activity that accepts a function as a parameter, you need to specify a second argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">writer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="dt">key =</span> <span class="st">"my_key"</span>, <span class="dt">value =</span> <span class="dv">123</span>, <span class="dt">global =</span> <span class="ot">TRUE</span>)

reader &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(function(attr, glb) <span class="kw">paste0</span>(attr[<span class="st">"my_key"</span>], <span class="st">", "</span>, glb[<span class="st">"my_key"</span>]))

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"writer"</span>, writer, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"reader"</span>, reader, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">1</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 1: reader0: NA, 123</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_attributes</a></span>(env)
<span class="co">#&gt;   time name    key value replication</span>
<span class="co">#&gt; 1    0      my_key   123           1</span></code></pre></div>
<p>As shown above, global attributes are reported in <code><a href="../reference/get_mon.html">get_mon_attributes()</a></code> as unnamed key/value pairs.</p>
</div>
<div id="timeout" class="section level3">
<h3 class="hasAnchor">
<a href="#timeout" class="anchor"></a><code><a href="../reference/timeout.html">timeout()</a></code>
</h3>
<p>At its simplest, the <code><a href="../reference/timeout.html">timeout(., task)</a></code> method delays the arrival’s advance through the trajectory for a specified amount of time. Consider the following minimal example where we simply supply a static value to the timeout’s <code>task</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dt">task =</span> <span class="dv">3</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient0          0        3             3     TRUE           1</span></code></pre></div>
<p>Often, however, you want a timeout to be dependent on a distribution or, for example, an earlier set attribute. This is achieved by passing a function in to form of either <code>function(){}</code> or <code>function(attrs){}</code> to the <code>task</code> parameter, as we explained before. In the following example, this functionality is demonstrated:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"health"</span>, function() <span class="kw">sample</span>(<span class="dv">20</span>:<span class="dv">80</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="co"># distribution-based timeout</span>
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">10</span>)) %&gt;%
<span class="st">  </span><span class="co"># attribute-dependent timeout</span>
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function(attrs) (<span class="dv">100</span> -<span class="st"> </span>attrs[[<span class="st">"health"</span>]]) *<span class="st"> </span><span class="dv">2</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient0          0 126.0675      126.0675     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_attributes</a></span>(env)
<span class="co">#&gt;   time     name    key value replication</span>
<span class="co">#&gt; 1    0 patient0 health    37           1</span></code></pre></div>
<p>Be aware that if you want the <code><a href="../reference/timeout.html">timeout()</a></code>’s <code>task</code> parameter to be evaluated dynamically, you should supply a callable function. For example in <code><a href="../reference/timeout.html">timeout(function() rexp(1, 10))</a></code>, <code>rexp(1, 10)</code> will be evaluated every time the timeout activity is executed. However, if you supply it in the form of <code><a href="../reference/timeout.html">timeout(rexp(1, 10))</a></code>, it will only be evaluated at the initalization and will remain static after that.</p>
<p>Of course, this <code>task</code>, supplied as a function, may be as complex as you need and, for instance, it may check a resource’s status, interact with other entities in your simulation model… The same applies to all the activities when they accept a function as a parameter.</p>
</div>
<div id="seize-release" class="section level3">
<h3 class="hasAnchor">
<a href="#seize-release" class="anchor"></a><code><a href="../reference/seize.html">seize()</a></code>, <code><a href="../reference/seize.html">release()</a></code>
</h3>
<p>The <code><a href="../reference/seize.html">seize(., resource, amount)</a></code> method seizes a specified <code>amount</code> of the resource named <code>resource</code>. Conversely, the <code><a href="../reference/seize.html">release(., resource, amount)</a></code> method releases a specified <code>amount</code> of the resource named <code>resource</code>. Be aware that, in order to use these functions in relation to a specific resource, you have to create it in your definition of the simulation environment (check <code><a href="../reference/add_resource.html">?add_resource</a></code>).</p>
<p>Consider the following example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="dt">resource =</span> <span class="st">"doctor"</span>, <span class="dt">amount =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="dt">resource =</span> <span class="st">"doctor"</span>, <span class="dt">amount =</span> <span class="dv">1</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity=</span><span class="dv">1</span>, <span class="dt">mon =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1   doctor    0      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 2   doctor    3      0     0        1        Inf      0   Inf           1</span></code></pre></div>
<p>Here the <code>mon=1</code> argument (=default) of <code><a href="../reference/add_resource.html">add_resource()</a></code> makes the simulation environment monitor the resource usage. Using the <code><a href="../reference/get_mon.html">get_mon_resources(env)</a></code> method you can get access to the log of the usage evolution of resources.</p>
<p>There are situations where you want to let the amount of resources seized/released be dependent on a specific function or on a previously set attribute. To achieve this, you can pass a function in the form of either <code>function(){}</code> or <code>function(attrs){}</code> to the <code>amount</code> parameter instead of a numeric value. If going for the latter, the current state of the arrival’s attributes will be passed to <code>attrs</code> as a list which you can inspect. This allows for the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"health"</span>, function() <span class="kw">sample</span>(<span class="dv">20</span>:<span class="dv">80</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"docs_to_seize"</span>, function(attrs) <span class="kw">ifelse</span>(attrs[[<span class="st">"health"</span>]]&lt;<span class="dv">50</span>, <span class="dv">1</span>, <span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"doctor"</span>, function(attrs) attrs[[<span class="st">"docs_to_seize"</span>]]) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"doctor"</span>, function(attrs) attrs[[<span class="st">"docs_to_seize"</span>]])

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity =</span> <span class="dv">2</span>, <span class="dt">mon =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1   doctor    0      1     0        2        Inf      1   Inf           1</span>
<span class="co">#&gt; 2   doctor    3      0     0        2        Inf      0   Inf           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_attributes</a></span>(env)
<span class="co">#&gt;   time     name           key value replication</span>
<span class="co">#&gt; 1    0 patient0        health    37           1</span>
<span class="co">#&gt; 2    0 patient0 docs_to_seize     1           1</span></code></pre></div>
<p>By default, an unsuccessful <code><a href="../reference/seize.html">seize()</a></code> results in the rejection of the arrival. In the following example, the second patient tries to seize the only doctor while the first patient is being attended. There is no waiting room available, therefore it is rejected:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"arriving..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="co"># the second patient won't reach this point</span>
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"doctor seized"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>, <span class="dt">queue_size =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 0: patient0: arriving...</span>
<span class="co">#&gt; 0: patient0: doctor seized</span>
<span class="co">#&gt; 1: patient1: arriving...</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient1          1        1             0    FALSE           1</span>
<span class="co">#&gt; 2 patient0          0        5             5     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1   doctor    0      1     0        1          0      1     1           1</span>
<span class="co">#&gt; 2   doctor    5      0     0        1          0      0     1           1</span></code></pre></div>
<p>Sometimes, you don’t want to reject an unsuccessful <code><a href="../reference/seize.html">seize()</a></code>, but to follow another path. Let’s modify the example above to enable the second patient to visit a nurse instead:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"arriving..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>, <span class="dt">continue =</span> <span class="ot">FALSE</span>,
        <span class="dt">reject =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"rejected patient"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"rejected!"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"nurse seized"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="co"># the second patient won't reach this point</span>
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"doctor seized"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>, <span class="dt">queue_size =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"nurse"</span>, <span class="dt">capacity =</span> <span class="dv">10</span>, <span class="dt">queue_size =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 0: patient0: arriving...</span>
<span class="co">#&gt; 0: patient0: doctor seized</span>
<span class="co">#&gt; 1: patient1: arriving...</span>
<span class="co">#&gt; 1: patient1: rejected!</span>
<span class="co">#&gt; 1: patient1: nurse seized</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient1          1        3             2     TRUE           1</span>
<span class="co">#&gt; 2 patient0          0        5             5     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1   doctor    0      1     0        1          0      1     1           1</span>
<span class="co">#&gt; 2    nurse    1      1     0       10          0      1    10           1</span>
<span class="co">#&gt; 3    nurse    3      0     0       10          0      0    10           1</span>
<span class="co">#&gt; 4   doctor    5      0     0        1          0      0     1           1</span></code></pre></div>
<p>The flag <code>continue</code> indicates whether the <code>reject</code> sub-trajectory should be connected to the main trajectory or not. In this case, with <code>continue=FALSE</code>, the rejected arrival seizes the nurse and its lifetime ends after releasing him/her. Otherwise, it would keep executing activities in the main trajectory.</p>
<p>Note that the second patient may also keep trying if he/she must see the doctor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"arriving..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>, <span class="dt">continue =</span> <span class="ot">FALSE</span>,
        <span class="dt">reject =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"rejected patient"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"rejected!"</span>) %&gt;%
<span class="st">          </span><span class="co"># go for a walk and try again</span>
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"retrying..."</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/rollback.html">rollback</a></span>(<span class="dt">amount =</span> <span class="dv">4</span>, <span class="dt">times =</span> <span class="ot">Inf</span>)) %&gt;%
<span class="st">  </span><span class="co"># the second patient will reach this point after a couple of walks</span>
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"doctor seized"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"leaving"</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>, <span class="dt">queue_size =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 0: patient0: arriving...</span>
<span class="co">#&gt; 0: patient0: doctor seized</span>
<span class="co">#&gt; 1: patient1: arriving...</span>
<span class="co">#&gt; 1: patient1: rejected!</span>
<span class="co">#&gt; 3: patient1: retrying...</span>
<span class="co">#&gt; 3: patient1: rejected!</span>
<span class="co">#&gt; 5: patient1: retrying...</span>
<span class="co">#&gt; 5: patient0: leaving</span>
<span class="co">#&gt; 5: patient1: doctor seized</span>
<span class="co">#&gt; 10: patient1: leaving</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient0          0        5             5     TRUE           1</span>
<span class="co">#&gt; 2 patient1          1       10             9     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1   doctor    0      1     0        1          0      1     1           1</span>
<span class="co">#&gt; 2   doctor    5      0     0        1          0      0     1           1</span>
<span class="co">#&gt; 3   doctor    5      1     0        1          0      1     1           1</span>
<span class="co">#&gt; 4   doctor   10      0     0        1          0      0     1           1</span></code></pre></div>
<p>There is another optional sub-trajectory called <code>post.seize</code> and, as its name suggests, it is executed after a successful <code><a href="../reference/seize.html">seize()</a></code>. Thus, you can do the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"arriving..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>, <span class="dt">continue =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>),
        <span class="dt">post.seize =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"admitted patient"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"admitted"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>),
        <span class="dt">reject =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"rejected patient"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"rejected!"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="co"># both patients will reach this point, as continue = c(TRUE, TRUE)</span>
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"leaving..."</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>, <span class="dt">queue_size =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"nurse"</span>, <span class="dt">capacity =</span> <span class="dv">10</span>, <span class="dt">queue_size =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 0: patient0: arriving...</span>
<span class="co">#&gt; 0: patient0: admitted</span>
<span class="co">#&gt; 1: patient1: arriving...</span>
<span class="co">#&gt; 1: patient1: rejected!</span>
<span class="co">#&gt; 13: patient1: leaving...</span>
<span class="co">#&gt; 15: patient0: leaving...</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient1          1       13            12     TRUE           1</span>
<span class="co">#&gt; 2 patient0          0       15            15     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1   doctor    0      1     0        1          0      1     1           1</span>
<span class="co">#&gt; 2    nurse    1      1     0       10          0      1    10           1</span>
<span class="co">#&gt; 3    nurse    3      0     0       10          0      0    10           1</span>
<span class="co">#&gt; 4   doctor    5      0     0        1          0      0     1           1</span></code></pre></div>
</div>
<div id="set_capacity-set_queue_size" class="section level3">
<h3 class="hasAnchor">
<a href="#set_capacity-set_queue_size" class="anchor"></a><code><a href="../reference/set_capacity.html">set_capacity()</a></code>, <code><a href="../reference/set_capacity.html">set_queue_size()</a></code>
</h3>
<p>The <code><a href="../reference/set_capacity.html">set_capacity(., resource, value)</a></code> method modifies the capacity of the specified resource by name, and the <code><a href="../reference/set_capacity.html">set_queue_size(., resource, value)</a></code> method modifies its queue size. Be aware that, in order to use these functions in relation to a specific resource, you have to create it in your definition of the simulation environment (check <code><a href="../reference/add_resource.html">?add_resource</a></code>). You can supply the <code>value</code> parameter either as a numeric value or as a function, in the form of either <code>function(){}</code> or <code>function(attrs){}</code>, which must return a numeric value.</p>
<p>These activities are interesting to introduce dynamical changes in the resources. For instance, consider the following example in which two trajectories fight for the capacity of their resource:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">12345</span>)
env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>()

increment &lt;-<span class="st"> </span>function(res) {
  function() <span class="kw"><a href="../reference/get_capacity.html">get_capacity</a></span>(env, res) +<span class="st"> </span><span class="dv">1</span>
}
decrement &lt;-<span class="st"> </span>function(res) {
  function() {
    n &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_capacity.html">get_capacity</a></span>(env, res) -<span class="st"> </span><span class="dv">1</span>
    if (n &lt;<span class="st"> </span><span class="dv">0</span>) <span class="dv">0</span>
    else n
  }
}

t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"res1"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_capacity.html">set_capacity</a></span>(<span class="dt">resource =</span> <span class="st">"res1"</span>, <span class="dt">value =</span> <span class="kw">increment</span>(<span class="st">"res1"</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_capacity.html">set_capacity</a></span>(<span class="dt">resource =</span> <span class="st">"res2"</span>, <span class="dt">value =</span> <span class="kw">decrement</span>(<span class="st">"res2"</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"res1"</span>, <span class="dv">1</span>)

t2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"res2"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_capacity.html">set_capacity</a></span>(<span class="dt">resource =</span> <span class="st">"res2"</span>, <span class="dt">value =</span> <span class="kw">increment</span>(<span class="st">"res2"</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_capacity.html">set_capacity</a></span>(<span class="dt">resource =</span> <span class="st">"res1"</span>, <span class="dt">value =</span> <span class="kw">decrement</span>(<span class="st">"res1"</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"res2"</span>, <span class="dv">1</span>)

env &lt;-<span class="st"> </span>env %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"res1"</span>, <span class="dt">capacity =</span> <span class="dv">20</span>, <span class="dt">queue_size =</span> <span class="ot">Inf</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"res2"</span>, <span class="dt">capacity =</span> <span class="dv">20</span>, <span class="dt">queue_size =</span> <span class="ot">Inf</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t1_"</span>, t1, function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t2_"</span>, t2, function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">100</span>)

<span class="kw">plot</span>(env, <span class="st">"resources"</span>, <span class="st">"usage"</span>, <span class="kw">c</span>(<span class="st">"res1"</span>, <span class="st">"res2"</span>), <span class="dt">steps =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="simmer-03-trajectories_files/figure-html/unnamed-chunk-17-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="select" class="section level3">
<h3 class="hasAnchor">
<a href="#select" class="anchor"></a><code><a href="../reference/select.html">select()</a></code>
</h3>
<p><code><a href="../reference/seize.html">seize()</a></code>, <code><a href="../reference/seize.html">release()</a></code>, <code><a href="../reference/set_capacity.html">set_capacity()</a></code> and <code><a href="../reference/set_capacity.html">set_queue_size()</a></code> work well when you know the resources implied beforehand. But sometimes the resource to choose may depend on a certain policy. For these situations, the <code><a href="../reference/select.html">select(., resources, policy, id)</a></code> method offers the possibility of selecting a resource at any point, and this choice will be observed by <code><a href="../reference/seize.html">seize_selected()</a></code>, <code><a href="../reference/seize.html">release_selected()</a></code>, <code><a href="../reference/set_capacity.html">set_capacity_selected()</a></code> and <code><a href="../reference/set_capacity.html">set_queue_size_selected()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/select.html">select</a></span>(<span class="dt">resources =</span> <span class="kw">c</span>(<span class="st">"doctor1"</span>, <span class="st">"doctor2"</span>, <span class="st">"doctor3"</span>), <span class="dt">policy =</span> <span class="st">"round-robin"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_capacity.html">set_capacity_selected</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize_selected</a></span>(<span class="dt">amount =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release_selected</a></span>(<span class="dt">amount =</span> <span class="dv">1</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor1"</span>, <span class="dt">capacity =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor2"</span>, <span class="dt">capacity =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor3"</span>, <span class="dt">capacity =</span> <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient0          0        5             5     TRUE           1</span>
<span class="co">#&gt; 2 patient1          1        6             5     TRUE           1</span>
<span class="co">#&gt; 3 patient2          2        7             5     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1  doctor1    0      0     0        1        Inf      0   Inf           1</span>
<span class="co">#&gt; 2  doctor1    0      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 3  doctor2    1      0     0        1        Inf      0   Inf           1</span>
<span class="co">#&gt; 4  doctor2    1      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 5  doctor3    2      0     0        1        Inf      0   Inf           1</span>
<span class="co">#&gt; 6  doctor3    2      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 7  doctor1    5      0     0        1        Inf      0   Inf           1</span>
<span class="co">#&gt; 8  doctor2    6      0     0        1        Inf      0   Inf           1</span>
<span class="co">#&gt; 9  doctor3    7      0     0        1        Inf      0   Inf           1</span></code></pre></div>
<p>If you provide <code><a href="../reference/select.html">select()</a></code> with <code>resources</code> as a vector of names, you can use one of the predefined policies (see <code><a href="../reference/select.html">?select</a></code>). If you need some custom policy, you can define it and supply it as a function. For instance, let’s pick a resource based on a previously set attribute:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"resource"</span>, function() <span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">3</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/select.html">select</a></span>(<span class="dt">resources =</span> function(attrs) <span class="kw">paste0</span>(<span class="st">"doctor"</span>, attrs[<span class="st">"resource"</span>])) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize_selected</a></span>(<span class="dt">amount =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release_selected</a></span>(<span class="dt">amount =</span> <span class="dv">1</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor1"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor2"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor3"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mon =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

<span class="kw"><a href="../reference/get_mon.html">get_mon_attributes</a></span>(env)
<span class="co">#&gt;   time     name      key value replication</span>
<span class="co">#&gt; 1    0 patient0 resource     2           1</span>
<span class="co">#&gt; 2    1 patient1 resource     3           1</span>
<span class="co">#&gt; 3    2 patient2 resource     3           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient0          0        5             5     TRUE           1</span>
<span class="co">#&gt; 2 patient1          1        6             5     TRUE           1</span>
<span class="co">#&gt; 3 patient2          2       11             5     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1  doctor2    0      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 2  doctor3    1      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 3  doctor3    2      1     1        1        Inf      2   Inf           1</span>
<span class="co">#&gt; 4  doctor2    5      0     0        1        Inf      0   Inf           1</span>
<span class="co">#&gt; 5  doctor3    6      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 6  doctor3   11      0     0        1        Inf      0   Inf           1</span></code></pre></div>
<p>And, of course, everything learned for <code><a href="../reference/seize.html">seize()</a></code>, <code><a href="../reference/seize.html">release()</a></code>, <code><a href="../reference/set_capacity.html">set_capacity()</a></code> and <code><a href="../reference/set_capacity.html">set_queue_size()</a></code> applies to all their <code>_selected</code> versions.</p>
</div>
<div id="activate-deactivate" class="section level3">
<h3 class="hasAnchor">
<a href="#activate-deactivate" class="anchor"></a><code><a href="../reference/activate.html">activate()</a></code>, <code><a href="../reference/activate.html">deactivate()</a></code>
</h3>
<p>The <code><a href="../reference/activate.html">activate(., generator)</a></code> and <code><a href="../reference/activate.html">deactivate(., generator)</a></code> methods are able to start or stop, respectively, a generator by name. This name can be supplied as either a string or a function returning a string. In the following simple example, the use of these methods spreads the interarrival times which otherwise would be of 1 unit of time, as defined in the generator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/activate.html">deactivate</a></span>(<span class="dt">generator =</span> <span class="st">"dummy"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/activate.html">activate</a></span>(<span class="dt">generator =</span> <span class="st">"dummy"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"dummy"</span>, t, function() <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>()
<span class="co">#&gt;     name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 dummy0          1        2             1     TRUE           1</span>
<span class="co">#&gt; 2 dummy1          3        4             1     TRUE           1</span>
<span class="co">#&gt; 3 dummy2          5        6             1     TRUE           1</span>
<span class="co">#&gt; 4 dummy3          7        8             1     TRUE           1</span></code></pre></div>
</div>
<div id="set_trajectory-set_distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#set_trajectory-set_distribution" class="anchor"></a><code><a href="../reference/set_trajectory.html">set_trajectory()</a></code>, <code><a href="../reference/set_trajectory.html">set_distribution()</a></code>
</h3>
<p>The <code><a href="../reference/set_trajectory.html">set_trajectory(., generator, trajectory)</a></code> and <code><a href="../reference/set_trajectory.html">set_distribution(., generator, distribution)</a></code> methods are able to install a new trajectory or distribution, respectively, in a generator by name. This name can be supplied as either a string or a function returning a string.</p>
<p>In the following distribution, <code>t2</code> changes the distribution and then switches to <code>t1</code>, so that only the first arrival takes <code>t2</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>)

t2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_trajectory.html">set_distribution</a></span>(<span class="st">"dummy"</span>, function() <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_trajectory.html">set_trajectory</a></span>(<span class="st">"dummy"</span>, t1) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"dummy"</span>, <span class="dt">trajectory =</span> t2, <span class="dt">distribution =</span> function() <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>()
<span class="co">#&gt;     name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 dummy0          2        4             2     TRUE           1</span>
<span class="co">#&gt; 2 dummy1          3        4             1     TRUE           1</span>
<span class="co">#&gt; 3 dummy2          4        5             1     TRUE           1</span>
<span class="co">#&gt; 4 dummy3          5        6             1     TRUE           1</span>
<span class="co">#&gt; 5 dummy4          6        7             1     TRUE           1</span>
<span class="co">#&gt; 6 dummy5          7        8             1     TRUE           1</span>
<span class="co">#&gt; 7 dummy6          8        9             1     TRUE           1</span></code></pre></div>
</div>
<div id="set_prioritization" class="section level3">
<h3 class="hasAnchor">
<a href="#set_prioritization" class="anchor"></a><code><a href="../reference/set_prioritization.html">set_prioritization()</a></code>
</h3>
<p>The <code><a href="../reference/add_generator.html">add_generator()</a></code> method assigns a set of prioritization values to each generated arrival: by default, <code>priority=0</code>, <code>preemptible=priority</code>, <code>restart=FALSE</code> (see <code><a href="../reference/add_generator.html">?add_generator</a></code> for more details). The <code><a href="../reference/set_prioritization.html">set_prioritization(., values)</a></code> method can change those values with more granularity at any point in the trajectory:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"priority"</span>, <span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="co"># static values</span>
<span class="st">  </span><span class="kw"><a href="../reference/set_prioritization.html">set_prioritization</a></span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="ot">TRUE</span>)) %&gt;%
<span class="st">  </span><span class="co"># dynamically with a function</span>
<span class="st">  </span><span class="kw"><a href="../reference/set_prioritization.html">set_prioritization</a></span>(<span class="dt">values =</span> function(attrs) <span class="kw">c</span>(attrs[<span class="st">"priority"</span>], <span class="dv">7</span>, <span class="ot">TRUE</span>))</code></pre></div>
<p>More details on prioritization in the <em>Advanced Resource Usage</em> vignette (pending).</p>
</div>
<div id="branch" class="section level3">
<h3 class="hasAnchor">
<a href="#branch" class="anchor"></a><code><a href="../reference/branch.html">branch()</a></code>
</h3>
<p>The <code><a href="../reference/branch.html">branch(., option, continue, ...)</a></code> method offers the possibility of adding alternative paths in the trajectory. The following example shows how a trajectory can be built with a 50-50 chance for an arrival to pass through each path of a two-path branch.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"trajectory with a branch"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"server"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(<span class="dt">option =</span> function() <span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">continue =</span> <span class="kw">c</span>(T, F), 
         <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"branch1"</span>) %&gt;%
<span class="st">           </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="dv">1</span>),
         <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"branch2"</span>) %&gt;%
<span class="st">           </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">3</span>)) %&gt;%
<span class="st">           </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"server"</span>, <span class="dv">1</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"server"</span>, <span class="dv">1</span>)</code></pre></div>
<p>When an arrival gets to the branch, the first argument is evaluated to select a specific path to follow, so it must be callable and must return a numeric value between 1 and <code>n</code>, where <code>n</code> is the number of paths defined. The second argument, <code>continue</code>, indicates whether the arrival must continue executing the activities after the selected path or not. In the example above, only the first path continues to the last <code><a href="../reference/seize.html">release()</a></code>.</p>
<p>Sometimes you may need to count how many times a certain trajectory in a certain branch is entered, or how much time arrivals spend inside that trajectory. For these situations, it is handy to use resources with infinite capacity just for <em>accounting</em> purposes, like in the example below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(function() <span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">1</span>), <span class="dt">continue =</span> <span class="kw">c</span>(T, T),
         <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">           </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"branch1"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">           </span><span class="co"># do stuff here</span>
<span class="st">           </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">           </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"branch1"</span>, <span class="dv">1</span>),
         <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">           </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"branch2"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">           </span><span class="co"># do stuff here</span>
<span class="st">           </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">1</span>/<span class="dv">2</span>)) %&gt;%
<span class="st">           </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"branch2"</span>, <span class="dv">1</span>))

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"dummy"</span>, t0, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">1000</span>))) %&gt;%
<span class="st">  </span><span class="co"># Resources with infinite capacity, just for accounting purposes</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"branch1"</span>, <span class="ot">Inf</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"branch2"</span>, <span class="ot">Inf</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()

arrivals &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env, <span class="dt">per_resource =</span> T)

<span class="co"># Times that each branch was entered</span>
<span class="kw">table</span>(arrivals$resource)
<span class="co">#&gt; </span>
<span class="co">#&gt; branch1 branch2 </span>
<span class="co">#&gt;     490     510</span>

<span class="co"># The `activity_time` is the total time inside each branch for each arrival</span>
<span class="co"># Let's see the distributions</span>
<span class="kw">ggplot</span>(arrivals) +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>activity_time)) +<span class="st"> </span><span class="kw">facet_wrap</span>(~resource)</code></pre></div>
<p><img src="simmer-03-trajectories_files/figure-html/unnamed-chunk-24-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="rollback" class="section level3">
<h3 class="hasAnchor">
<a href="#rollback" class="anchor"></a><code><a href="../reference/rollback.html">rollback()</a></code>
</h3>
<p>The <code><a href="../reference/rollback.html">rollback(., amount, times, check)</a></code> method allows an arrival to rollback the trajectory an <code>amount</code> number of steps.</p>
<p>Consider the following where a string is printed in the timeout function. After the first run, the trajectory is rolled back 3 times (so that it prints “Hello!” <em>four</em> times).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"Hello!"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/rollback.html">rollback</a></span>(<span class="dt">amount =</span> <span class="dv">2</span>, <span class="dt">times =</span> <span class="dv">3</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"hello_sayer"</span>, t0, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: hello_sayer0: Hello!</span>
<span class="co">#&gt; 1: hello_sayer0: Hello!</span>
<span class="co">#&gt; 2: hello_sayer0: Hello!</span>
<span class="co">#&gt; 3: hello_sayer0: Hello!</span></code></pre></div>
<p>The <code><a href="../reference/rollback.html">rollback()</a></code> method also accepts an optional <code>check</code> parameter which overrides the default amount-based behaviour. This parameter must be a function that returns a logical value. Each time an arrival reaches the activity, this <code>check</code> is evaluated to determine whether the <code><a href="../reference/rollback.html">rollback()</a></code> with <code>amount</code> steps must be performed or not. Consider the following example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"happiness"</span>, <span class="dv">0</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(function(attrs) {
    <span class="kw">paste0</span>(<span class="st">"&gt;&gt; Happiness level is at: "</span>, attrs[[<span class="st">"happiness"</span>]], <span class="st">" -- "</span>, 
           <span class="kw">ifelse</span>(attrs[[<span class="st">"happiness"</span>]]&lt;<span class="dv">25</span>,<span class="st">"PETE: I'm feeling crappy..."</span>,
                  <span class="kw">ifelse</span>(attrs[[<span class="st">"happiness"</span>]]&lt;<span class="dv">50</span>,<span class="st">"PETE: Feelin' a bit moody"</span>,
                         <span class="kw">ifelse</span>(attrs[[<span class="st">"happiness"</span>]]&lt;<span class="dv">75</span>,<span class="st">"PETE: Just had a good espresso"</span>,
                                <span class="st">"PETE: Let's do this! (and stop this loop...)"</span>))))
  }) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/set_attribute.html">set_attribute</a></span>(<span class="st">"happiness"</span>, function(attrs) attrs[[<span class="st">"happiness"</span>]] +<span class="st"> </span><span class="dv">25</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/rollback.html">rollback</a></span>(<span class="dt">amount =</span> <span class="dv">2</span>, <span class="dt">check =</span> function(attrs) attrs[[<span class="st">"happiness"</span>]] &lt;<span class="st"> </span><span class="dv">100</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"mood_swinger"</span>, t0, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: mood_swinger0: &gt;&gt; Happiness level is at: 0 -- PETE: I'm feeling crappy...</span>
<span class="co">#&gt; 0: mood_swinger0: &gt;&gt; Happiness level is at: 25 -- PETE: Feelin' a bit moody</span>
<span class="co">#&gt; 0: mood_swinger0: &gt;&gt; Happiness level is at: 50 -- PETE: Just had a good espresso</span>
<span class="co">#&gt; 0: mood_swinger0: &gt;&gt; Happiness level is at: 75 -- PETE: Let's do this! (and stop this loop...)</span></code></pre></div>
</div>
<div id="leave" class="section level3">
<h3 class="hasAnchor">
<a href="#leave" class="anchor"></a><code><a href="../reference/leave.html">leave()</a></code>
</h3>
<p>The <code><a href="../reference/leave.html">leave(., prob)</a></code> method allows an arrival to leave the trajectory with some probability:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"before leave"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/leave.html">leave</a></span>(<span class="dt">prob =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"after leave"</span>) %&gt;%
<span class="st">  </span><span class="co"># patients will never seize the doctor</span>
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"nurse"</span>, <span class="dt">capacity=</span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity=</span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 3: patient0: before leave</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1    nurse    0      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 2    nurse    3      0     0        1        Inf      0   Inf           1</span></code></pre></div>
<p>And of course, this probability may be evaluated dynamically also:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)

patient_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"patient_trajectory"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"nurse"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"before leave"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/leave.html">leave</a></span>(<span class="dt">prob =</span> function() <span class="kw">runif</span>(<span class="dv">1</span>) &lt;<span class="st"> </span><span class="fl">0.5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"after leave"</span>) %&gt;%
<span class="st">  </span><span class="co"># some patients will seize the doctor</span>
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"doctor"</span>, <span class="dv">1</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"nurse"</span>, <span class="dt">capacity=</span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"doctor"</span>, <span class="dt">capacity=</span><span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"patient"</span>, patient_traj, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt; 3: patient0: before leave</span>
<span class="co">#&gt; 6: patient1: before leave</span>
<span class="co">#&gt; 6: patient1: after leave</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 patient0          0        3             3    FALSE           1</span>
<span class="co">#&gt; 2 patient1          1        9             6     TRUE           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_resources</a></span>(env)
<span class="co">#&gt;   resource time server queue capacity queue_size system limit replication</span>
<span class="co">#&gt; 1    nurse    0      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 2    nurse    1      1     1        1        Inf      2   Inf           1</span>
<span class="co">#&gt; 3    nurse    3      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 4    nurse    6      0     0        1        Inf      0   Inf           1</span>
<span class="co">#&gt; 5   doctor    6      1     0        1        Inf      1   Inf           1</span>
<span class="co">#&gt; 6   doctor    9      0     0        1        Inf      0   Inf           1</span></code></pre></div>
</div>
<div id="clone-synchronize" class="section level3">
<h3 class="hasAnchor">
<a href="#clone-synchronize" class="anchor"></a><code><a href="../reference/clone.html">clone()</a></code>, <code><a href="../reference/clone.html">synchronize()</a></code>
</h3>
<p>The <code><a href="../reference/clone.html">clone(., n, ...)</a></code> method offers the possibility of replicating an arrival <code>n-1</code> times to be processed through up to <code>n</code> sub-trajectories in parallel. Then, the <code><a href="../reference/clone.html">synchronize(., wait, mon_all)</a></code> method synchronizes and removes replicas. By default, <code><a href="../reference/clone.html">synchronize()</a></code> waits for all of the replicas to arrive and allows the last one to continue:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">clone</a></span>(<span class="dt">n =</span> <span class="dv">3</span>,
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"original"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>),
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"clone 1"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>),
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"clone 2"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">synchronize</a></span>(<span class="dt">wait =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="fl">0.5</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt;          0 | generator: arrival        |       new: arrival0       | 0</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Clone          | 3, 3 paths</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 1</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 2</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 3</span>
<span class="co">#&gt;          1 |   arrival: arrival0       |  activity: Synchronize    | 1</span>
<span class="co">#&gt;          2 |   arrival: arrival0       |  activity: Synchronize    | 1</span>
<span class="co">#&gt;          3 |   arrival: arrival0       |  activity: Synchronize    | 1</span>
<span class="co">#&gt;          3 |   arrival: arrival0       |  activity: Timeout        | 0.5</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 arrival0          0      3.5           3.5     TRUE           1</span></code></pre></div>
<p>Note that the parameter <code>n</code> may also be a function. If there are more sub-trajectories than clones, the extra ones are ignored. If there are less sub-trajectories than clones, some clones will continue to the next activity directly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">clone</a></span>(<span class="dt">n =</span> <span class="dv">3</span>,
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"original"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>),
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"clone 1"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">synchronize</a></span>(<span class="dt">wait =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="fl">0.5</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt;          0 | generator: arrival        |       new: arrival0       | 0</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Clone          | 3, 2 paths</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 1</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 2</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Synchronize    | 1</span>
<span class="co">#&gt;          1 |   arrival: arrival0       |  activity: Synchronize    | 1</span>
<span class="co">#&gt;          2 |   arrival: arrival0       |  activity: Synchronize    | 1</span>
<span class="co">#&gt;          2 |   arrival: arrival0       |  activity: Timeout        | 0.5</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 arrival0          0      2.5           2.5     TRUE           1</span></code></pre></div>
<p>The behaviour of <code><a href="../reference/clone.html">synchronize()</a></code> can be modified in order to let the first clone pass and remove the others by setting <code>wait=FALSE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">clone</a></span>(<span class="dt">n =</span> <span class="dv">3</span>,
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"original"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>),
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"clone 1"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>),
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"clone 2"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">synchronize</a></span>(<span class="dt">wait =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="fl">0.5</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt;          0 | generator: arrival        |       new: arrival0       | 0</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Clone          | 3, 3 paths</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 1</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 2</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 3</span>
<span class="co">#&gt;          1 |   arrival: arrival0       |  activity: Synchronize    | 0</span>
<span class="co">#&gt;          1 |   arrival: arrival0       |  activity: Timeout        | 0.5</span>
<span class="co">#&gt;          2 |   arrival: arrival0       |  activity: Synchronize    | 0</span>
<span class="co">#&gt;          3 |   arrival: arrival0       |  activity: Synchronize    | 0</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 arrival0          0      1.5           1.5     TRUE           1</span></code></pre></div>
<p>By default, <code><a href="../reference/clone.html">synchronize()</a></code> does not record information about the clones removed (<code>mon_all=FALSE</code>). However, if it is required, you can get it by setting <code>mon_all=TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">clone</a></span>(<span class="dt">n =</span> <span class="dv">3</span>,
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"original"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>),
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"clone 1"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>),
        <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="st">"clone 2"</span>) %&gt;%
<span class="st">          </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">3</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/clone.html">synchronize</a></span>(<span class="dt">wait =</span> <span class="ot">FALSE</span>, <span class="dt">mon_all =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="fl">0.5</span>)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"arrival"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt;          0 | generator: arrival        |       new: arrival0       | 0</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Clone          | 3, 3 paths</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 1</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 2</span>
<span class="co">#&gt;          0 |   arrival: arrival0       |  activity: Timeout        | 3</span>
<span class="co">#&gt;          1 |   arrival: arrival0       |  activity: Synchronize    | 0</span>
<span class="co">#&gt;          1 |   arrival: arrival0       |  activity: Timeout        | 0.5</span>
<span class="co">#&gt;          2 |   arrival: arrival0       |  activity: Synchronize    | 0</span>
<span class="co">#&gt;          3 |   arrival: arrival0       |  activity: Synchronize    | 0</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;       name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 arrival0          0      1.5           1.5     TRUE           1</span>
<span class="co">#&gt; 2 arrival0          0      2.0           2.0     TRUE           1</span>
<span class="co">#&gt; 3 arrival0          0      3.0           3.0     TRUE           1</span></code></pre></div>
</div>
<div id="batch-separate" class="section level3">
<h3 class="hasAnchor">
<a href="#batch-separate" class="anchor"></a><code><a href="../reference/batch.html">batch()</a></code>, <code><a href="../reference/batch.html">separate()</a></code>
</h3>
<p>The <code><a href="../reference/batch.html">batch(., n, timeout, permanent, name, rule)</a></code> method offers the possibility of collecting a number of arrivals before they can continue processing as a block. Then, the <code><a href="../reference/batch.html">separate(.)</a></code> method splits a previously established non-permanent batch. This allows us to implement a rollercoaster process, for instance.</p>
<p>Let us consider a rollercoaster, with up to 10 places and a queue of 20 people, that lasts 5 minutes. We can model this problem as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)

t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">10</span>, <span class="dt">timeout =</span> <span class="dv">5</span>, <span class="dt">permanent =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"rollercoaster"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"rollercoaster"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="co"># capacity and queue_size are defined in batches of 10</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"rollercoaster"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>, <span class="dt">queue_size =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"person"</span>, t, function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">15</span>)

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env, <span class="dt">per_resource =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt;        name start_time  end_time activity_time      resource replication</span>
<span class="co">#&gt; 1   person0   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 2   person1   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 3   person2   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 4   person3   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 5   person4   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 6   person5   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 7   person6   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 8   person7   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 9   person8   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 10  person9   3.800074  8.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 11 person10   8.800074 13.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 12 person11   8.800074 13.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 13 person12   8.800074 13.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 14 person13   8.800074 13.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 15 person14   8.800074 13.800074             5 rollercoaster           1</span>
<span class="co">#&gt; 16 person15   8.800074 13.800074             5 rollercoaster           1</span></code></pre></div>
<p>We can see above that 3 batches have been created. The first 10 people arrive within 3.8 minutes and goes into the rollercoaster. When the ride ends, at 8.8, there are only 6 people waiting, but the <code><a href="../reference/batch.html">batch()</a></code> timer (<code>timeout=5</code>) has run out, and another ride starts with them. These batches are non-permanent (<code>permanent=FALSE</code>), so that <code><a href="../reference/batch.html">separate()</a></code> can split them and people can go their separate ways.</p>
<p>The optional argument <code>rule</code> accepts a function to perform a fine-grained selection of which arrivals should be batched. For each particular arrival, it is batched if the function returns <code>TRUE</code>, or it simply continues otherwise. For instance, in the example above, we can prevent batching by returning always <code>FALSE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_batch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">10</span>, <span class="dt">timeout =</span> <span class="dv">5</span>, <span class="dt">permanent =</span> <span class="ot">FALSE</span>, <span class="dt">rule =</span> function() <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"rollercoaster"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"rollercoaster"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()

t_nobatch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"rollercoaster"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"rollercoaster"</span>, <span class="dv">1</span>)

<span class="kw">set.seed</span>(<span class="dv">1234</span>)

env_batch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="co"># capacity and queue_size are defined in batches of 10</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"rollercoaster"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>, <span class="dt">queue_size =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"person"</span>, t_batch, function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">15</span>)

<span class="kw">set.seed</span>(<span class="dv">1234</span>)

env_nobatch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="co"># capacity and queue_size are defined in batches of 10</span>
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"rollercoaster"</span>, <span class="dt">capacity =</span> <span class="dv">1</span>, <span class="dt">queue_size =</span> <span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"person"</span>, t_nobatch, function() <span class="kw">rexp</span>(<span class="dv">1</span>, <span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">15</span>)

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env_batch, <span class="dt">per_resource =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt;      name start_time  end_time activity_time      resource replication</span>
<span class="co">#&gt; 1 person0   1.250879  6.250879             5 rollercoaster           1</span>
<span class="co">#&gt; 2 person1   1.374259 11.250879             5 rollercoaster           1</span>
<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env_nobatch, <span class="dt">per_resource =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt;      name start_time  end_time activity_time      resource replication</span>
<span class="co">#&gt; 1 person0   1.250879  6.250879             5 rollercoaster           1</span>
<span class="co">#&gt; 2 person1   1.374259 11.250879             5 rollercoaster           1</span></code></pre></div>
<p>By default, batches are unnamed (<code>name=""</code>), which makes them independent of one another. However, it may be interesting to feed a common batch from different trajectories. For instance, we can try this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()

t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/join.html">join</a></span>(t0)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t0_"</span>, t0, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t1_"</span>, t1, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt;          0 | generator: t0_            |       new: t0_0           | 0</span>
<span class="co">#&gt;          0 | generator: t1_            |       new: t1_0           | 0</span>
<span class="co">#&gt;          0 |   arrival: t0_0           |  activity: Batch          | 2, 0, 0, </span>
<span class="co">#&gt;          0 |   arrival: t1_0           |  activity: Timeout        | 1</span>
<span class="co">#&gt;          1 |   arrival: t1_0           |  activity: Batch          | 2, 0, 0,</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt; [1] name          start_time    end_time      activity_time finished     </span>
<span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></code></pre></div>
<p>But we don’t get the expected output because the arrivals are feeding two different batches. The arrival following <code>t1</code> join <code>t0</code> after the timeout, but effectively this is <strong>a clone</strong> of <code>t0</code>, which means that the above definition is equivalent to the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()

t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()</code></pre></div>
<p>Thus, arrivals following a different trajectory will end up in a different batch in general. Nonetheless, there is one way to share a common batch across <code><a href="../reference/batch.html">batch()</a></code> activities. This can be done by using a common name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">2</span>, <span class="dt">name =</span> <span class="st">"mybatch"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()

t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">2</span>, <span class="dt">name =</span> <span class="st">"mybatch"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t0_"</span>, t0, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t1_"</span>, t1, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt;          0 | generator: t0_            |       new: t0_0           | 0</span>
<span class="co">#&gt;          0 | generator: t1_            |       new: t1_0           | 0</span>
<span class="co">#&gt;          0 |   arrival: t0_0           |  activity: Batch          | 2, 0, 0, mybatch</span>
<span class="co">#&gt;          0 |   arrival: t1_0           |  activity: Timeout        | 1</span>
<span class="co">#&gt;          1 |   arrival: t1_0           |  activity: Batch          | 2, 0, 0, mybatch</span>
<span class="co">#&gt;          1 |   arrival: batch_mybatch  |  activity: Timeout        | 2</span>
<span class="co">#&gt;          3 |   arrival: batch_mybatch  |  activity: Separate       |</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;   name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 t0_0          0        3             2     TRUE           1</span>
<span class="co">#&gt; 2 t1_0          0        3             3     TRUE           1</span></code></pre></div>
<p>Or, equivalently,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">2</span>, <span class="dt">name =</span> <span class="st">"mybatch"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">separate</a></span>()

t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/join.html">join</a></span>(t0)

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t0_"</span>, t0, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"t1_"</span>, t1, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>()
<span class="co">#&gt;          0 | generator: t0_            |       new: t0_0           | 0</span>
<span class="co">#&gt;          0 | generator: t1_            |       new: t1_0           | 0</span>
<span class="co">#&gt;          0 |   arrival: t0_0           |  activity: Batch          | 2, 0, 0, mybatch</span>
<span class="co">#&gt;          0 |   arrival: t1_0           |  activity: Timeout        | 1</span>
<span class="co">#&gt;          1 |   arrival: t1_0           |  activity: Batch          | 2, 0, 0, mybatch</span>
<span class="co">#&gt;          1 |   arrival: batch_mybatch  |  activity: Timeout        | 2</span>
<span class="co">#&gt;          3 |   arrival: batch_mybatch  |  activity: Separate       |</span>

<span class="kw"><a href="../reference/get_mon.html">get_mon_arrivals</a></span>(env)
<span class="co">#&gt;   name start_time end_time activity_time finished replication</span>
<span class="co">#&gt; 1 t0_0          0        3             2     TRUE           1</span>
<span class="co">#&gt; 2 t1_0          0        3             3     TRUE           1</span></code></pre></div>
</div>
<div id="send-trap-untrap-wait" class="section level3">
<h3 class="hasAnchor">
<a href="#send-trap-untrap-wait" class="anchor"></a><code><a href="../reference/send.html">send()</a></code>, <code><a href="../reference/send.html">trap()</a></code>, <code><a href="../reference/send.html">untrap()</a></code>, <code><a href="../reference/send.html">wait()</a></code>
</h3>
<p>These activities enable asynchronous programming. The <code><a href="../reference/send.html">send(., signals, delay)</a></code> method broadcasts a signal or a list of signals to all the arrivals subscribed to them. Signals can be triggered immediately:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="dt">signals =</span> <span class="kw">c</span>(<span class="st">"signal1"</span>, <span class="st">"signal2"</span>))

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt;          0 | generator: signaler       |       new: signaler0      | 0</span>
<span class="co">#&gt;          0 |   arrival: signaler0      |  activity: Send           | [signal1, signal2, ], 0</span>
<span class="co">#&gt;          0 |      task: Broadcast      |                           |</span></code></pre></div>
<p>or after some delay:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="dt">signals =</span> <span class="kw">c</span>(<span class="st">"signal1"</span>, <span class="st">"signal2"</span>), <span class="dt">delay =</span> <span class="dv">3</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt;          0 | generator: signaler       |       new: signaler0      | 0</span>
<span class="co">#&gt;          0 |   arrival: signaler0      |  activity: Send           | [signal1, signal2, ], 3</span>
<span class="co">#&gt;          3 |      task: Broadcast      |                           |</span></code></pre></div>
<p>Note that both arguments, <code>signals</code> and <code>delay</code>, can be functions, and therefore they can retrieve the arrival’s attributes.</p>
<p>This is not very useful if nobody is listening. Arrivals can subscribe to signals and (optionally) assign a handler with the <code><a href="../reference/send.html">trap(., signals, handler, interruptible)</a></code>. In the following example, an arrival subscribes to a signal and blocks until its reception using the <code><a href="../reference/send.html">wait(.)</a></code> method.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_blocked &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">trap</a></span>(<span class="st">"you shall pass"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"waiting..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">wait</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"continuing!"</span>)

t_signaler &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"you shall pass"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"you shall pass"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"blocked"</span>, t_blocked, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t_signaler, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">5</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: blocked0: waiting...</span>
<span class="co">#&gt; 5: signaler0: you shall pass</span>
<span class="co">#&gt; 5: blocked0: continuing!</span></code></pre></div>
<p>Note that signals are ignored when an arrival is waiting in a resource’s queue. The same applies inside a batch: all the signals subscribed before entering the batch are ignored. Thus, the following batch will block indifinitely:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_blocked &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">trap</a></span>(<span class="st">"you shall pass"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"waiting inside a batch..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/batch.html">batch</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">wait</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"continuing!"</span>)

t_signaler &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"you shall pass"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"you shall pass"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"blocked"</span>, t_blocked, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t_signaler, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">5</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: blocked0: waiting inside a batch...</span>
<span class="co">#&gt; 5: signaler0: you shall pass</span></code></pre></div>
<p>Upon a signal reception, the arrival stops the current activity and executes the handler if provided. Then, the execution returns to the activity following the point of the interruption:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_worker &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">trap</a></span>(<span class="st">"you are free to go"</span>, 
       <span class="dt">handler =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"ok, I'm packing..."</span>) %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"performing a looong task..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">100</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"and I'm leaving!"</span>)

t_signaler &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"you are free to go"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"you are free to go"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"worker"</span>, t_worker, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t_signaler, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">5</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: worker0: performing a looong task...</span>
<span class="co">#&gt; 5: signaler0: you are free to go</span>
<span class="co">#&gt; 5: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 6: worker0: and I'm leaving!</span></code></pre></div>
<p>Finally, the <code><a href="../reference/send.html">untrap(., signals)</a></code> method can be used to unsubscribe from signals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_worker &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">trap</a></span>(<span class="st">"you are free to go"</span>, 
       <span class="dt">handler =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"ok, I'm packing..."</span>) %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"performing a looong task..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">untrap</a></span>(<span class="st">"you are free to go"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">100</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"and I'm leaving!"</span>)

t_signaler &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"you are free to go"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"you are free to go"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"worker"</span>, t_worker, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t_signaler, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">5</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: worker0: performing a looong task...</span>
<span class="co">#&gt; 5: signaler0: you are free to go</span>
<span class="co">#&gt; 100: worker0: and I'm leaving!</span></code></pre></div>
<p>Signal handlers can be interrupted as well by default, meaning that a handler may keep restarting if there are frequent enough signals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_worker &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">trap</a></span>(<span class="st">"you are free to go"</span>, 
       <span class="dt">handler =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"ok, I'm packing..."</span>) %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"performing a looong task..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">100</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"and I'm leaving!"</span>)

t_signaler &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"you are free to go"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"you are free to go"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"worker"</span>, t_worker, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t_signaler, <span class="kw"><a href="../reference/from.html">from</a></span>(<span class="dv">5</span>, function() <span class="fl">0.5</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">10</span>) %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: worker0: performing a looong task...</span>
<span class="co">#&gt; 5: signaler0: you are free to go</span>
<span class="co">#&gt; 5: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 5.5: signaler1: you are free to go</span>
<span class="co">#&gt; 5.5: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 6: signaler2: you are free to go</span>
<span class="co">#&gt; 6: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 6.5: signaler3: you are free to go</span>
<span class="co">#&gt; 6.5: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 7: signaler4: you are free to go</span>
<span class="co">#&gt; 7: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 7.5: signaler5: you are free to go</span>
<span class="co">#&gt; 7.5: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 8: signaler6: you are free to go</span>
<span class="co">#&gt; 8: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 8.5: signaler7: you are free to go</span>
<span class="co">#&gt; 8.5: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 9: signaler8: you are free to go</span>
<span class="co">#&gt; 9: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 9.5: signaler9: you are free to go</span>
<span class="co">#&gt; 9.5: worker0: ok, I'm packing...</span></code></pre></div>
<p>If an uninterruptible handler is needed, this can be achieved by setting the proper flag:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_worker &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">trap</a></span>(<span class="st">"you are free to go"</span>, 
       <span class="dt">handler =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"ok, I'm packing..."</span>) %&gt;%
<span class="st">         </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>),
       <span class="dt">interruptible =</span> <span class="ot">FALSE</span>            <span class="co"># make it uninterruptible</span>
  ) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"performing a looong task..."</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">100</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"and I'm leaving!"</span>)

t_signaler &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"you are free to go"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"you are free to go"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"worker"</span>, t_worker, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"signaler"</span>, t_signaler, <span class="kw"><a href="../reference/from.html">from</a></span>(<span class="dv">5</span>, function() <span class="fl">0.5</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">10</span>) %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: worker0: performing a looong task...</span>
<span class="co">#&gt; 5: signaler0: you are free to go</span>
<span class="co">#&gt; 5: worker0: ok, I'm packing...</span>
<span class="co">#&gt; 5.5: signaler1: you are free to go</span>
<span class="co">#&gt; 6: worker0: and I'm leaving!</span>
<span class="co">#&gt; 6: signaler2: you are free to go</span>
<span class="co">#&gt; 6.5: signaler3: you are free to go</span>
<span class="co">#&gt; 7: signaler4: you are free to go</span>
<span class="co">#&gt; 7.5: signaler5: you are free to go</span>
<span class="co">#&gt; 8: signaler6: you are free to go</span>
<span class="co">#&gt; 8.5: signaler7: you are free to go</span>
<span class="co">#&gt; 9: signaler8: you are free to go</span>
<span class="co">#&gt; 9.5: signaler9: you are free to go</span></code></pre></div>
</div>
<div id="renege_in-renege_if-renege_abort" class="section level3">
<h3 class="hasAnchor">
<a href="#renege_in-renege_if-renege_abort" class="anchor"></a><code><a href="../reference/renege_in.html">renege_in()</a></code>, <code><a href="../reference/renege_in.html">renege_if()</a></code>, <code><a href="../reference/renege_in.html">renege_abort()</a></code>
</h3>
<p>The <code><a href="../reference/renege_in.html">renege_in(., t, out)</a></code> method offers the possibility of setting a timeout after which the arrival will abandon the trajectory. After reneging, the arrival can follow an optional sub-trajectory <code>out</code>. The <code><a href="../reference/renege_in.html">renege_abort(.)</a></code> method cancels the latter. Together, they allows us, for instance, to model arrivals with limited patience. In the example below, <code>customer1</code> arrives at the bank, where there is only one busy clerk. He/she waits in the queue for 5 minutes and then leaves.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"bank"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"Here I am"</span>) %&gt;%
<span class="st">  </span><span class="co"># renege in 5 minutes</span>
<span class="st">  </span><span class="kw"><a href="../reference/renege_in.html">renege_in</a></span>(<span class="dv">5</span>, 
            <span class="dt">out =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">              </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"Lost my patience. Reneging..."</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"clerk"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="co"># stay if I'm being attended within 5 minutes</span>
<span class="st">  </span><span class="kw"><a href="../reference/renege_in.html">renege_abort</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"I'm being attended"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"clerk"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"Finished"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"clerk"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"customer"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: customer0: Here I am</span>
<span class="co">#&gt; 0: customer0: I'm being attended</span>
<span class="co">#&gt; 1: customer1: Here I am</span>
<span class="co">#&gt; 6: customer1: Lost my patience. Reneging...</span>
<span class="co">#&gt; 10: customer0: Finished</span></code></pre></div>
<p>The same can be achieved with <code><a href="../reference/renege_in.html">renege_if(., signal, out)</a></code> if <code>customer0</code> sends a signal to <code>customer1</code> at <code>t=5</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>(<span class="dt">name =</span> <span class="st">"bank"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"Here I am"</span>) %&gt;%
<span class="st">  </span><span class="co"># renege when "renege now" is received</span>
<span class="st">  </span><span class="kw"><a href="../reference/renege_in.html">renege_if</a></span>(<span class="st">"renege now"</span>, 
            <span class="dt">out =</span> <span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">              </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"Ok. Reneging..."</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"clerk"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="co"># stay if I'm being attended within 5 minutes</span>
<span class="st">  </span><span class="kw"><a href="../reference/renege_in.html">renege_abort</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"I'm being attended"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"I say: renege now"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/send.html">send</a></span>(<span class="st">"renege now"</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">5</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"clerk"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/log_.html">log_</a></span>(<span class="st">"Finished"</span>)

<span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_resource.html">add_resource</a></span>(<span class="st">"clerk"</span>, <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"customer"</span>, t, <span class="kw"><a href="../reference/at.html">at</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>() %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; 0: customer0: Here I am</span>
<span class="co">#&gt; 0: customer0: I'm being attended</span>
<span class="co">#&gt; 1: customer1: Here I am</span>
<span class="co">#&gt; 5: customer0: I say: renege now</span>
<span class="co">#&gt; 5: customer1: Ok. Reneging...</span>
<span class="co">#&gt; 10: customer0: Finished</span></code></pre></div>
<p>Note that, in contrast to <code><a href="../reference/send.html">trap()</a></code>, reneging is triggered even if the arrival is in a queue or is part of a non-permanent batch.</p>
</div>
</div>
<div id="manipulating-trajectories-joining-and-subsetting" class="section level2">
<h2 class="hasAnchor">
<a href="#manipulating-trajectories-joining-and-subsetting" class="anchor"></a>Manipulating trajectories: joining and subsetting</h2>
<div id="join" class="section level3">
<h3 class="hasAnchor">
<a href="#join" class="anchor"></a><code><a href="../reference/join.html">join()</a></code>
</h3>
<p>The <code><a href="../reference/join.html">join(...)</a></code> method is very useful to concatenate together any number of trajectories. It may be used as a standalone function as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/seize.html">seize</a></span>(<span class="st">"dummy"</span>, <span class="dv">1</span>)
t2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>)
t3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/seize.html">release</a></span>(<span class="st">"dummy"</span>, <span class="dv">1</span>)

t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/join.html">join</a></span>(t1, t2, t3)
t0
<span class="co">#&gt; trajectory: anonymous, 3 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span></code></pre></div>
<p>Or it may operate inline, like another activity:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/join.html">join</a></span>(t1) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(<span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/join.html">join</a></span>(t3)
t0
<span class="co">#&gt; trajectory: anonymous, 3 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span></code></pre></div>
</div>
<div id="section" class="section level3">
<h3 class="hasAnchor">
<a href="#section" class="anchor"></a><code>[</code>, <code>[[</code>
</h3>
<p>You can think about a trajectory object as a list of activities that has a length</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(t0)
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>and can be subset using the standard operator <code>[</code>. For instance, you can select the activities you want with a logical vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0[<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)]
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span></code></pre></div>
<p>Or a set of indices that respect the order given:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)]
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span>
t0[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>)]
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span></code></pre></div>
<p>Or a set of indices to remove from the selection:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0[-<span class="dv">2</span>]
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span></code></pre></div>
<p>Or by name, but note that this does <strong>not</strong> respect the order given though, because it performs a match:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0[<span class="kw">c</span>(<span class="st">"seize"</span>, <span class="st">"release"</span>)]
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span>
t0[<span class="kw">c</span>(<span class="st">"release"</span>, <span class="st">"seize"</span>)]
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span></code></pre></div>
<p>If you provide no indices, the whole trajectory is returned:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0[]
<span class="co">#&gt; trajectory: anonymous, 3 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span></code></pre></div>
<p>In fact, you are <strong>cloning</strong> the trajectory with the latter command. It is equivalent to <code>t0[1:length(t0)]</code> or <code><a href="../reference/join.html">join(t0)</a></code>.</p>
<p>The generics <code>head()</code> and <code>tail()</code> use the <code>[</code> operator under the hood, thus you can use them as well:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(t0, <span class="dv">2</span>)
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Seize        | resource: dummy, amount: 1 }</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span>
<span class="kw">tail</span>(t0, -<span class="dv">1</span>)
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span>
<span class="co">#&gt; { Activity: Release      | resource: dummy, amount: 1 }</span></code></pre></div>
<p>The <code>[[</code> operator can also be used to extract <strong>only one</strong> element:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t0[[<span class="dv">2</span>]]
<span class="co">#&gt; trajectory: anonymous, 1 activities</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span></code></pre></div>
<p>which is equivalent to <code>t0[2]</code>. If a string is provided, it ensures that only the first match is returned:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/join.html">join</a></span>(t0, t0)[<span class="st">"timeout"</span>]
<span class="co">#&gt; trajectory: anonymous, 2 activities</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span>
<span class="kw"><a href="../reference/join.html">join</a></span>(t0, t0)[[<span class="st">"timeout"</span>]]
<span class="co">#&gt; trajectory: anonymous, 1 activities</span>
<span class="co">#&gt; { Activity: Timeout      | delay: 1 }</span></code></pre></div>
</div>
</div>
<div id="interacting-with-the-environment-from-within-a-trajectory" class="section level2">
<h2 class="hasAnchor">
<a href="#interacting-with-the-environment-from-within-a-trajectory" class="anchor"></a>Interacting with the environment from within a trajectory</h2>
<p>It is possible to interact with the simulation environment in order to extract parameters of interest such as the current simulation time (<code><a href="../reference/now.html">now()</a></code>), status of resources (<code><a href="../reference/get_capacity.html">get_capacity()</a></code>, <code><a href="../reference/get_capacity.html">get_queue_size()</a></code>, <code><a href="../reference/get_capacity.html">get_server_count()</a></code>, <code>get_queue_count</code>()), status of generators (<code><a href="../reference/get_n_generated.html">get_n_generated()</a></code>) or directly to gather the history of monitored values (<code>get_mon_*()</code>). You may also want (or in other words, your model may need) to check and use all this information to take decisions inside a given trajectory.</p>
<p>For instance, let’s suppose we just want to print the simulation time at a given point in a trajectory. The only requirement is that you must define the simulation environment <strong>before</strong> running the simulation. This won’t work:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">remove</span>(env)

t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">print</span>(env %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/now.html">now</a></span>()))

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"dummy"</span>, t, function() <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">4</span>)
<span class="co">#&gt; Error in run_(private$sim_obj, until): Evaluation error: objeto 'env' no encontrado.</span></code></pre></div>
<p>Because the global <code>env</code> is not available at runtime: the simulation runs <em>and then</em> the resulting object is assigned to <code>env</code>. We need to assign first, then run. So this will work:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">print</span>(env %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/now.html">now</a></span>()))

env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"dummy"</span>, t, function() <span class="dv">1</span>)

env %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">4</span>) %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>And we get the expected output. However, as a general rule of good practice, <strong>it is recommended to instantiate the environment always in the first place</strong>, to avoid possible mistakes and because the code becomes more readable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, instantiate the environment</span>
env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simmer.html">simmer</a></span>()

<span class="co"># Here I'm using it</span>
t &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectory.html">trajectory</a></span>() %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/timeout.html">timeout</a></span>(function() <span class="kw">print</span>(env %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/now.html">now</a></span>()))

<span class="co"># And finally, run it</span>
env %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/add_generator.html">add_generator</a></span>(<span class="st">"dummy"</span>, t, function() <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/run.html">run</a></span>(<span class="dv">4</span>) %&gt;%<span class="st"> </span>invisible
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#available-set-of-activities">Available set of activities</a></li>
      <li><a href="#manipulating-trajectories-joining-and-subsetting">Manipulating trajectories: joining and subsetting</a></li>
      <li><a href="#interacting-with-the-environment-from-within-a-trajectory">Interacting with the environment from within a trajectory</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Iñaki Ucar, Bart Smeets.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
